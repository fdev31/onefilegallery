#!/usr/bin/env python
from __future__ import print_function
import os
import sys
import subprocess

TMP='/tmp/'

class FatalError(SystemExit): pass

def progress_maker(cur, maxi):
    if cur == maxi:
        return ' Done!'
    return '%5.1f%%'%((cur*100.0/maxi))


def dontloadtwice(decorated):
    def _decorator(self, img=None, *args, **kw):
        if isinstance(img, str):
            if self.current_img_name != img:
                self.current_img_name = img
                img = self.current_img = self._load(img)
            else:
                img = self.current_img
        img = decorated(self, img or self.current_img, *args, **kw )
        return img
    return _decorator


class BaseImageHandler:

    MAX_SZ = 200 # pixels

    _rot_map = {
            6: 270,
            8: 90,
            1: 0,
        }

    def __init__(self):
        self.current_img_name = ''

    @dontloadtwice
    def get_rotation(self, img):
        r = self._exif_rot(img)
        if r:
            return self._rot_map[r]
        return 0

class JpegTranHandler(BaseImageHandler):

    _rot_map = {
            6: 270,
            8: -90,
            1: 0,
        }

    def _load(self, img):
        return jpegtran.JPEGImage( img )

    def _exif_rot(self, img):
        return img.exif_orientation

    @dontloadtwice
    def minify(self, img, size=None):
        w, h = img.width, img.height
        size = size or self.MAX_SZ
        if w > h:
            aspect = h/w
            nw = size
            nh = int(aspect * size)
        else:
            aspect = w/h
            nh = size
            wh = int(aspect * size)
        img = img.downscale(nw, nh)
        return img

    @dontloadtwice
    def save(self, img, path, quality):
        return img.save(path)

    @dontloadtwice
    def rotate(self, img, angle):
        if angle:
            return img.rotate(angle)
        return img


class PILHandler(BaseImageHandler):
    def _load(self, img):
        return Image.open( img )

    def _exif_rot(self, img):
        e = img._getexif()
        if e and 274 in e:
            return e[274]

    @dontloadtwice
    def rotate(self, img, angle):
        if angle:
            return img.rotate(angle)
        return img


    @dontloadtwice
    def minify(self, img, size=None):
        sz = size or self.MAX_SZ
        imgcopy = img
#        imgcopy = img.copy() # XXX: commenting this is a bug that is a speed boost
        imgcopy.thumbnail( (sz, sz), Image.ANTIALIAS )
        return imgcopy

    @dontloadtwice
    def save(self,img , path, quality):
        img = img.save( path, quality=quality, progressive=True, optimize=True)
        return img

try:
    import jpegtran
    ImageHandler = JpegTranHandler
except:
    from PIL import Image
    ImageHandler = PILHandler

SUPPORTED_FILES = set(('jpg', 'jpeg', 'mp4'))

class ImageList:

    filenames = []
    infos = []

    def __init__(self, path, overwrite=False):
        files = [fname for fname in os.listdir(path) if fname.rsplit('.')[-1].lower() in SUPPORTED_FILES]
        files.sort()
        filenames = []
        infos = []
        for i, name in enumerate(files):
            print('\r' + progress_maker(i, len(files)), end='')
            fullpath = os.path.join(path, name)
            filenames.append(fullpath)
            infos.append(dict(t='tn/'+name, f=name, s=os.stat(fullpath).st_size)) # more info to come ?
        print('\r' + progress_maker(len(files), len(files)), end='')
        self.filenames = filenames
        self.infos = infos
        self.overwrite = overwrite

    def __len__(self):
        return len(self.filenames)

    def make_thumbs(self, out, tn_size):
        tn_path = os.path.join(out.path, 'tn')
        img_mgr = ImageHandler()
        if not os.path.isdir(tn_path):
            try:
                os.makedirs( tn_path )
            except OSError:
                print('%s must be a valid folder'%tn_path)
                raise FatalError()
        for i, fullpath in enumerate(self.filenames):
            print('\r' + progress_maker(i, len(self.filenames)), end='')
            name = os.path.basename(fullpath)
            t_tn_path = os.path.join( tn_path, name )
            if self.overwrite or not os.path.exists(t_tn_path):
                if fullpath.endswith('.mp4'):
                    subprocess.Popen(['ffmpegthumbnailer', '-i', fullpath, '-o', t_tn_path, '-s', str(tn_size or img_mgr.MAX_SZ)]).communicate()
                else:
                    rot = img_mgr.get_rotation( fullpath )
                    src_img = img_mgr.minify( fullpath, tn_size)
                    src_img = img_mgr.rotate( src_img, rot)
                    img_mgr.save(src_img, t_tn_path, quality=60 )
        print('\r' + progress_maker(len(self.filenames), len(self.filenames)), end='')

class Output:
    path = None
    def __init__(self, path):
        self.path = path
    def open_file(self, name, mode='w'):
        return open(os.path.join(self.path, name), mode)

class Writer:
    def __init__(self, images, out):
        self.out = out
        self.images = images

class JSONWriter(Writer):
    def write(self, index='images.js'):
        import json
        c = list(self.images.infos[0].keys())
        r = [list(i.values()) for i in self.images.infos]
        json.dump({'c': c, 'r': r, 'version': 1}, self.out.open_file(index))

class HTMLWriter(Writer):

    def write(self, index='index.html'):
        tn_path = os.path.join(self.out.path, 'tn')
        fd = open(os.path.join(self.out.path, index), 'w')

        fd.write("""<!DOCTYPE HTML>
            <html>
            <head>
            <title>Gallery</title>
            </head>
            <body>
            <a href="package.zip">Download all files</a><br/>
            <div id="container">""")

        for i in self.images.infos:
            fd.write('<a href="%(f)s"><img src="%(t)s" /></a>\n'%i)

        fd.write("</div></body></html>")

INDEX = """<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
        <title>Gallery</title>
        <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>
        <style>
body{background:#CCC;margin:0;padding:0;font-family:'PT Sans',sans-serif}#container{transition:none;zoom:1}#global_container{padding:1ex;transition:none}div.item:hover{z-index:3;transform:rotateZ(0)!important;transition-duration:300ms}div.action_icon{cursor:pointer}img{border:none;margin:1ex;border:solid 3px #FFF;border-radius:3px;cursor:pointer;-moz-box-shadow:0px 0px 5px 2px #656565;-webkit-box-shadow:0px 0px 5px 2px #656565;-o-box-shadow:0px 0px 5px 2px #656565;box-shadow:0px 0px 5px 2px #656565;filter:progid:DXImageTransform.Microsoft.Shadow(color=#656565,Direction=NaN,Strength=5);-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px}img.tn:hover{border:solid 12px #FFF;transform:scale(1.1);transition-duration:300ms;transition-timing-function:ease}a{font-weight:bold}h1{margin:0;color:#999}button{font:bold 20px/1 "helvetica neue",helvetica,arial,sans-serif;margin:2px 1ex;text-align:center;text-shadow:0 3px 0 #333;cursor:pointer;color:rgb(150, 150, 250);background:#555;border:solid 3px #FEF;border-radius:3px;margin-right:1ex;padding:5px}button:hover{border-color:#FBA;transition-duration:300ms;transform:scale(1.25)}button.current{color:#FBA}hr{margin:.5ex auto 0 auto;width:50%}input#delay{border-radius:3px;float:left;font-size:150%;background-color:#999;color:#eee;padding:0.4ex 0px 0px;text-align:center;border:medium none}button.busy{color:yellow}#projector{position:fixed;top:0;left:0;width:98%;height:98%;background-color:#333;margin:0;padding:1%;z-index:3;transition-property:top;transition-duration:230ms;transition-timing-function:ease-in}#projected_video{margin:auto auto 0 auto;width:90%;min-width:10px;min-height:10px;max-width:90%;max-height:90%}#projected{display:block;position:relative;top:-64px;margin:auto auto 0 auto;min-width:10px;min-height:10px;max-width:90%;max-height:90%;transition-property:opacity,transform;transition-duration:1000ms;cursor:help}#popup{position:fixed;left:50%;top:50%;text-align:center;background:rgba(255, 255, 255, 0.8);padding:1ex;border:3px solid #AAA;color:black;font-weight:bold;transition-property:top;transition-duration:230ms;transition-timing-function:ease-in;z-index:42;margin-left:-40ex;width:80ex}.cache{display:block;width:1px;height:1px;opacity:0.1;margin-top:1ex;border:none}.slide-down{top:101%!important}.pull-right{float:right}.bg_caption{text-decoration:none}.bigfont{font-size:200%;font-weight:bold}.loading{opacity:0.0}.icon_cross,.icon_cycle,.icon_hdd,.icon_left,.icon_pack,.icon_right,.icon_play,.icon_stop{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSI2NHB4IgogICB2aWV3Qm94PSIwIDAgNjQgNTEyIgogICBoZWlnaHQ9IjUxMnB4IgogICBpZD0ic3ZnMiIKICAgdmVyc2lvbj0iMS4xIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29ucy5zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMxOSIgLz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MTgiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1OSIKICAgICBpZD0ibmFtZWR2aWV3MTciCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6em9vbT0iMy40NzY2MDgzIgogICAgIGlua3NjYXBlOmN4PSItMi42NTEzMjUzIgogICAgIGlua3NjYXBlOmN5PSI4Ni43MTUxODIiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMiI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgaWQ9ImdyaWQzNzc0IiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogICAgICAgIAo8c3ZnCnk9IjAiCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIAogICB2ZXJzaW9uPSIxLjEiCiAgIHdpZHRoPSI2NCIKICAgaGVpZ2h0PSI2NCIKICAgaWQ9InN2ZzM4MDkiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuNDguNSByMTAwNDAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Imljb25fcGFjay5zdmciPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiM2MzYzNjMiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC42Nzg0MzEzNyIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iOTU4IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwNTkiCiAgICAgaWQ9Im5hbWVkdmlldzI5OTgiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjUuMjE0OTEyNSIKICAgICBpbmtzY2FwZTpjeD0iMTUuNzY0OTcyIgogICAgIGlua3NjYXBlOmN5PSIzOS42MjgyNDQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlkPSJnMjk4OSIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLjg0ODYzNDk0LC0wLjcyNjc5NTYxLDAuNzcyMTE4NjYsMC43OTg4MjA0MiwtMTUuMjUzNTgxLDI3LjEzNTgwNykiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICBkPSJtIDI3LjYxMzExOSwzLjk3OTgxNzYgYyAzLjE4NzAxNCwwIDUuNzUyNzMzLDIuNTY1NzE5IDUuNzUyNzMzLDUuNzUyNzMzMyBsIDAsNDYuMDIxODY2MSBjIDAsMy4xODcwMTQgLTIuNTY1NzE5LDUuNzUyNzMzIC01Ljc1MjczMyw1Ljc1MjczMyAtMy4xODcwMTQsMCAtNS43NTI3MzMsLTIuNTY1NzE5IC01Ljc1MjczMywtNS43NTI3MzMgbCAwLC00Ni4wMjE4NjYxIGMgMCwtMy4xODcwMTQzIDIuNTY1NzE5LC01Ljc1MjczMzMgNS43NTI3MzMsLTUuNzUyNzMzMyB6IgogICAgICAgaWQ9InJlY3QyOTg1IiAvPgogICAgPHBhdGgKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAsLTEsMSwwLDAsMCkiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIgogICAgICAgZD0ibSAtMzIuNzQzNDgzLC0xLjE1MDU0NzUgYyAzLjE4NzAxNSwwIDUuNzUyNzM0LDIuNTY1NzE5IDUuNzUyNzM0LDUuNzUyNzMzMiBsIDAsNDYuMDIxODY2MyBjIDAsMy4xODcwMTQgLTIuNTY1NzE5LDUuNzUyNzMzIC01Ljc1MjczNCw1Ljc1MjczMyAtMy4xODcwMTQsMCAtNS43NTI3MzMsLTIuNTY1NzE5IC01Ljc1MjczMywtNS43NTI3MzMgbCAwLC00Ni4wMjE4NjYzIGMgMCwtMy4xODcwMTQyIDIuNTY1NzE5LC01Ljc1MjczMzIgNS43NTI3MzMsLTUuNzUyNzMzMiB6IgogICAgICAgaWQ9InJlY3QyOTg3IiAvPgogIDwvZz4KPC9zdmc+Cgo8c3ZnCnk9IjY0IgogICAKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgdmVyc2lvbj0iMS4xIgogICB3aWR0aD0iNjQiCiAgIGhlaWdodD0iNjQiCiAgIGlkPSJzdmczODA5IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29uX2N5Y2xlLnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzdmN2Y3ZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY2Mjc0NTEiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjgwOCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIzNjQiCiAgICAgaWQ9Im5hbWVkdmlldzciCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjMuNjg3NSIKICAgICBpbmtzY2FwZTpjeD0iMzIiCiAgICAgaW5rc2NhcGU6Y3k9IjMyIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIxMTEwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIzNjYiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmczODA5IiAvPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMzODExIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTM4MTQiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaWQ9ImxheWVyMSIKICAgICBzdHlsZT0iZmlsbDojZmZmZmZmIj4KICAgIDxwYXRoCiAgICAgICBkPSJtIDM2LjA5NjI3MSwxLjg3NTg4ODMgYyAtOC40MzE2NTMsMCAtOC44NTE1MzUsMC4wODc4MyAtNy41NjU2NTIsMS41NjMzODYgMC43NDkzNDEsMC44NTk4NjEgMi45ODA0OTMsNC41NDA3NjcgNC45NjkzMTksOC4xNzk4MzA3IGwgMy42MjkyNzksNi42MTY0NjUgLTEuOTI2MzA3LDEuNjQ3MTM1IGMgLTEuOTA0MzY0LDEuNjE0ODA4IC0xLjgxMTI5OCwxLjYzODU0MSA1LjYxMTQyMiwxLjQyMzc5MSBsIDcuNTM3NzM5LC0wLjIyMzMzNiAzLjM3ODAyLC01LjgwNjg1MyBjIDMuOTc0NTUxLC02LjgzMjcwNDcgNC4xNzk1MjQsLTcuODcwNDc3NyAxLjIwMDQ1NSwtNS45MTg1MTY3IC0yLjE1MzY2MywxLjQxMTEyNzcgLTIuMjQ4NzA4LDEuMzgzOTA3NyAtMy42ODUxMTUsLTEuNDUxNzEzIC0yLjk1NTk3MywtNS44MzUzOTUgLTMuMzkwNTk5LC02LjAzMDE4OSAtMTMuMTQ5MTYsLTYuMDMwMTg5IHogbSAtMTMuODE5MTg2LDAuODkzMzYxIGMgLTMuMjk3NDQ5LDAuMTk0OTI1IC00LjkxNzg0MiwyLjAyNDU0NyAtOS40NjQwNDYsOS45Mzg2NDc3IGwgLTIuMzcyOTg3LDQuMTAzODczIDYuMDU4MTAyLDMuNjU3MjAyIGMgMy4zMjU5OCwyLjAwNzkyOSA2LjMzNzk1OCwzLjU2MzQ3OCA2LjcwMDIxNCwzLjQ2MTc3IDAuMzYyMjU2LC0wLjEwMTY5IDIuNDE1NDMsLTMuMTgyNTk5IDQuNTc4NDc2LC02Ljg2NzcxNCAzLjY2NzA3MSwtNi4yNDc0NiAzLjg0NjA1MywtNi44NjEzNzcgMi43MDgwMDUsLTkuMDczMjAwNyAtMi4wMzE5NDQsLTMuOTQ5MDg0IC0zLjg0MzYxNiwtNS4yMjA1NzggLTcuNTA5ODI2LC01LjIyMDU3OCAtMC4yMzYwNTUsMCAtMC40NzgxMDgsLTAuMDEyOTMgLTAuNjk3OTM4LDAgeiBNIDU1Ljk0NTY0NSwyMC42MzY0OCBjIC0xLjE2MjEzNywwIC0xMi40MTUyNjYsNi43MDAxNTggLTEyLjQyMzMwOCw3LjM5ODE0NCAtMC4wMDQ3LDAuMzg0MzY3IDEuNzA4NTU4LDMuNjY3OTE1IDMuNzk2Nzg3LDcuMzE0MzkzIDMuNzQ3Nyw2LjU0NDI3MiAzLjg0ODc1Myw2LjY1NjU0NSA3LjgxNjkxLDYuOTc5Mzg2IDIuMjExMDY2LDAuMTc5ODkxIDAuMTAwNSwwLjM4NjA3MyAtNC42OTAxNDgsMC40NzQ2MDMgbCAtOC43MTAyNywwLjE2NzUgMCwtMi4yMzM0MDIgYyAwLC0zLjQ4MDE1MSAtMS4wNDkwMjIsLTIuNjcyODA4IC00LjcxODA2MiwzLjYwMTM2NSBsIC0zLjQwNTk0Myw1LjgwNjg0NCAzLjQwNTk0Myw2LjIyNTYxMiBjIDMuNjA3ODcsNi42MjQ4MDYgNC43MTgwNjIsNy41ODIwMzYgNC43MTgwNjIsNC4wNDgwNDUgMCwtMi4wMzc2OTggMC4zNTk4MTgsLTIuMjA3MzE2IDUuMTM2ODI4LC0yLjQ1NjczNyBsIDUuMTM2ODI4LC0wLjI1MTI1OCA0LjI0MzQ2OCwtNy40NTM5ODkgYyAyLjM0MjY1NiwtNC4wOTEzMjIgNC4wNjQ0NzcsLTcuNzM2MDI5IDMuODI0NzAxLC04LjEyNDAwNSAtMC4yMzk3ODYsLTAuMzg3OTg1IDAuMzY4OTI5LC0xLjQzODMxIDEuMzQwMDQxLC0yLjMxNzE1MSAyLjc3NTIyOSwtMi41MTE1NDIgMi4yNzEwOTEsLTcuMDA0ODcyIC0xLjUzNTQ2MywtMTMuNTEyMDkyIC0xLjgyMTgwNSwtMy4xMTQzMzMgLTMuNTk4NzA0LC01LjY2NzI1OCAtMy45MzYzNzQsLTUuNjY3MjU4IHogbSAtNDAuMjU3MDkzLDIuNjgwMDgyIC03Ljc2MTA4MzIsMC4wMjc4NCBjIC03LjAwMDU1MDc2LDAuMDI1NjggLTcuNTcwNzIzMTIsMC4xNTM3MiAtNi4wMDIyNjYyLDEuMzQwMDUgMC45NTM3NzEsMC43MjEzOSAyLjA5NDQzNDQsMS4zMTIxMTggMi41MTI1NzMzLDEuMzEyMTE4IDAuNDE4MTU3NywwIC0wLjI1ODQ1NjksMS43NDkxNDQgLTEuNTA3NTQwMiwzLjg4MDUzNyAtMS4yNDkwODMzLDIuMTMxNDAyIC0yLjI4OTIzODA2LDQuNDAxMzYgLTIuMjg5MjM4MDYsNS4wNTMwNzkgMCwwLjY1MTcxOSAxLjkxNTA2ODg2LDQuNTYyMTI5IDQuMjQzNDU4NTYsOC43MTAyNzEgMy4wOTczODY2LDUuNTE4MTc3IDQuMzU1OTkzMSw3LjEwNDEzNCA0LjY5MDE0ODIsNS44OTA2MDMgMC4yNTExOTI2LC0wLjkxMjI0OCAyLjE3NzE0MzYsLTQuNzYzNjA2IDQuMjk5MzAzNiwtOC41NzA2ODUgMy40OTU2NDUsLTYuMjcxMDQzIDQuMDM1MTM5LC02Ljg0Nzg0MiA1LjY2NzI1OSwtNS45NzQzNTMgMi45ODg3MjMsMS41OTk1MSAyLjg1NzUyNiwwLjM1MTIzMyAtMC41ODYyNjcsLTUuODA2ODU0IGwgLTMuMjY2MzQ4LC01Ljg2MjY4IHogbSAxNS40MTA0NzYsMTkuNTcwMTk0IC04Ljc2NjEwNywwLjI3OTE3MiAtOC43MzgxODQsMC4yNTEyNTggLTEuNzAyOTcyLDMuMTgyNjA4IGMgLTEuOTk0MjI1NCwzLjcyNDU3NiAtMS40ODk5MzcsNy4wMDQ1NjIgMS40Nzk2MjcsOS43NzExMzEgMS43MzE5MDcsMS42MTM0NzYgMi45MTA1MjIsMS44MTQ2NzIgOS41NzU3MTgsMS41OTEzMDggbCA3LjYyMTQ4OCwtMC4yNTEyNTggMC4yNTEyNTgsLTcuMzk4MTUzIDAuMjc5MTcyLC03LjQyNjA2NiB6IgogICAgICAgaWQ9InBhdGgyOTk4IgogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZiIgLz4KICA8L2c+Cjwvc3ZnPgoKPHN2Zwp5PSIxMjgiCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIAogICB2ZXJzaW9uPSIxLjEiCiAgIHdpZHRoPSI2NCIKICAgaGVpZ2h0PSI2NCIKICAgaWQ9InN2ZzM4MDkiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuNDguNSByMTAwNDAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Imljb25faGRkLnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzFlMWUxZSIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjM0OTAxOTYxIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxOTIwIgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwODAiCiAgICAgaWQ9Im5hbWVkdmlldzI5ODkiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjMuNjg3NSIKICAgICBpbmtzY2FwZTpjeD0iLTIuNjEyNDI0OCIKICAgICBpbmtzY2FwZTpjeT0iNDMuMjAyMzUzIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8cGF0aAogICAgIHN0eWxlPSJmaWxsOiNmZmZmZmYiCiAgICAgZD0iTSAzMS42ODc1LDEuNTMxMjUgQyAzMS4zMTIwNCwxLjU3NDM0NzcgMzAuOTY0NzU1LDEuNzE1Mzc4NCAzMC42NTYyNSwyIDMwLjI1NTc3OSwyLjMxNjQ0NzggMjkuOTI5NDksMi43MTAxNzA5IDI5LjU2MjUsMy4wNjI1IGMgLTguNmUtNCwwLjA4OTc5OCA4LjZlLTQsMC4xOTE0NTIxIDAsMC4yODEyNSAtMC4wMTA5LDIuMzc5ZS00IC0wLjAyMDM2LC0yLjQxMmUtNCAtMC4wMzEyNSwwIGwgMCw0LjY4NzUgYyAwLjAxMDM5LC0yLjYzZS01IDAuMDIwOTIsNy4xN2UtNSAwLjAzMTI1LDAgMC4wMDEzLDEuMzc2NzkyMyAwLjIxNjMzLDIuNjA5NjM4IC0wLjA2MjUsMy44NDM3NSAtMC41MDYxMDcsMi4yNDAwNSAtNy4zMTc5OTgsMC41OTA1NDIgLTEwLjA5Mzc1LDEuNjU2MjUgLTAuOTk0Njk2LDAuNTgxNTU5IC0wLjA0MywxLjc4ODcxNCAwLjQ2ODc1LDIuMzc1IDMuNjczNTE5LDMuNTgwOCA3LjIzMjI1LDcuMjkyMzM4IDEwLjkzNzUsMTAuODQzNzUgMS4xNTQzMjksMC44MzQxNzUgMi42NjM1MjgsMC4wOTc4NCAzLjQ2ODc1LC0wLjg3NSAxLjk3MzY4MywtMi4xMjE1MjcgNC4wOTM4MzgsLTQuMTE3OTQyIDYuMTI1LC02LjE4NzUgMS4zODQ5OTYsLTEuNDE2MDA5IDIuODI4NDUxLC0yLjc4MjgzNCA0LjE1NjI1LC00LjI1IDAuNjAzODAxLC0wLjc0Mjk4NyAwLjI3NTA5NSwtMi4wNjczNjkgLTAuNzUsLTIuMTg3NSAtMi42OTI2MjMsMC4yMzMwMyAtNS4zOTA0NzYsMC4xMDk4NTMgLTcuOTA2MjUsLTAuMDYyNSAtMS4xMDA3OTMsLTAuMjY0NTU0IC0xLjY2MjE3NiwtMS4zODk1NzIgLTEuNjg3NSwtMi40Njg3NSBsIC0wLjA2MjUsMCAwLC04LjAzMTI1IEMgMzMuNjY5Mzc0LDIuMDUyNjY0MSAzMi44NjQxMjEsMS41NzYwNzkzIDMyLjA2MjUsMS41MzEyNSBjIC0wLjEyNjc5NywtMC4wMDcwOSAtMC4yNDk4NDcsLTAuMDE0MzY2IC0wLjM3NSwwIHogbSAtNi4yNSwyIEMgMTcuNTY4MjM4LDQuMDk1NDU0MSAxMi4xNjcxOTQsNS44MzE4OTU3IDYuNzE4NzUsOS40Mzc1IGMgLTUuNjEwODE4NCwzLjcxMzA2OCAtNS45Mzc1LDQuODkyOTM2IC01LjkzNzUsMjQgMCwxNi43MzU5NTYgMC4wMzg5MDA1LDE2Ljk3NDA3MyAyLjE1NjI1LDE5Ljc1IDIuNTQyMzAxMywzLjMzMzEzNyA5Ljc3NDA4Nyw2Ljk3MDQ1OSAxNy4wOTM3NSw4LjU2MjUgMTQuMDkzNzE1LDMuMDY1Mzg5IDMxLjYzNjU4MywwLjAxNDg5IDM5LjA5Mzc1LC02Ljc4MTI1IDQuMDc1MzAzLC0zLjcxNDA1MSA0LjQzNzUsLTUuNTA4OTk1IDQuNDM3NSwtMjIuMDYyNSAwLC0xNy42NzgxMjUgLTAuMzMxNzMyLC0xOS4wMDgxMDggLTYuMTg3NSwtMjMuMjUgQyA1Mi41MDIzLDYuMTI2NDc3MyA0Ni40NDI1ODEsNC4xOTUyMjE1IDM4LjI1LDMuNTYyNSBjIDAsMCAtMC41NzUzMzIsMi4zOTgyMTAxIDAsNC44MTI1IDAuOTE0MzE1LDAuMTc3MDAxOCAxLjcxMTUyNywtMC42Njc3MzI4IDEwLjYyNSwyLjAzMTI1IDguNzMxNDQyLDIuNjQzODY0IDExLjY1Njk0Niw4LjM0MzA1NSA3LjcxODc1LDEyLjI4MTI1IC0yLjcyMTQxNSwyLjcyMTQwNiAtOS45NzkyOCw1LjcxMDY4OCAtMTYuMjUsNi43MTg3NSAtOC43ODQyMiwxLjQxMjE0MyAtMTUuNjcxMDc0LDAuODgzNDQxIC0yMy45Mzc1LC0xLjgxMjUgQyAxMC42MTc3NDUsMjUuNzA1OTQzIDUuMDkzNzUsMjEuNjQwNzYxIDUuMDkzNzUsMTkuMjUgYyAwLC0zLjk4NTEyNiA2LjY3MjMzOCwtOC40NTM4MjYgMTUuNTkzNzUsLTEwLjQzNzUgMS4zMzExMzksLTAuMjk1OTc1OCAyLjk2MjYyMSwtMC40OTA5NTcgNC43NSwtMC42MjUgeiBNIDUuMDkzNzUsMjcuODEyNSA5LjI1LDI5LjkwNjI1IGMgMTIuMTA3MjI0LDYuMDgxMTE0IDMzLjM1NTcxNSw2LjI2NzAxIDQ0Ljg0Mzc1LDAuNDA2MjUgMS44NTc5OTQsLTAuOTQ3ODY4IDMuNTg4NDUsLTEuNzE4NzUgMy44NDM3NSwtMS43MTg3NSAwLjI1NTMsMCAwLjQ2ODc1LDEuNTU2NTc0IDAuNDY4NzUsMy40MDYyNSAwLDQuMTM4Mjg1IC0yLjc0NTM3LDYuNzQ2NjI3IC0xMC4wNjI1LDkuNTYyNSAtNi4xNjczNDgsMi4zNzMzOTYgLTIxLjUwMDI3OSwzLjEzMTY3NCAtMjguMTg3NSwxLjM3NSBDIDkuNDczMjM5Miw0MC4xMzExNTUgNS4wOTM3NSwzNi43MTQ1MzMgNS4wOTM3NSwzMS4yNSB6IG0gNTMuMzEyNSwxNC41MzEyNSAwLDMuNDY4NzUgYyAwLDIuNjcyNjUxIC0wLjUzNDM0LDQuMDAzNzMyIC0yLjI1LDUuNTkzNzUgQyA1My41MjgzMTksNTMuODQxNzMgNDYuMjAwMTIxLDU2Ljc2MjczIDQxLDU3LjQzNzUgMzMuODAxMjgsNTguMzcxNjE2IDMxLjIyMDQzNSw1OC40MzUxNTggMjUuMTg3NSw1Ny44MTI1IDE4LjExNjgxMyw1Ny4wODI3MTcgOS4yNTMyODE5LDUzLjQ2MzY1OSA2Ljc1LDUwLjI4MTI1IDQuODU1NzM2OSw0Ny44NzMwODggNC4zODk5NzI2LDQxLjg3ODQzIDYuMTU2MjUsNDIuNjU2MjUgYyAxMy4wMTU4MTgsNS43MzE4NjYgMjEuODAzMjA1LDcuMjUyNDg5IDMzLjA5Mzc1LDUuNzUgNy4yMjk0NTksLTAuOTYyMDY3IDExLjc1NTU4LC0yLjIzNDA3IDE2LjUsLTQuNjg3NSB6IgogICAgIGlkPSJwYXRoMzAwMCIKICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0ic2NjY2NjY3NjY2NjY2NjY2NjY2NzY3Nzc3Nzc3NjY3Nzc3Nzc2NjY2Nzc3Nzc3NjY3Nzc3Nzc3NjYyIgLz4KPC9zdmc+Cgo8c3ZnCnk9IjE5MiIKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIHZlcnNpb249IjEuMSIKICAgd2lkdGg9IjY0IgogICBoZWlnaHQ9IjY0IgogICBpZD0ic3ZnMzgwOSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC41IHIxMDA0MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iaWNvbl9yaWdodC5zdmciPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiM2MzYzNjMiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC42Nzg0MzEzNyIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iOTU4IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwNTkiCiAgICAgaWQ9Im5hbWVkdmlldzI5OTgiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjUuMjE0OTEyNSIKICAgICBpbmtzY2FwZTpjeD0iMTUuNTM2NjY2IgogICAgIGlua3NjYXBlOmN5PSIyNi4wMzc3MzUiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlkPSJnMzAyNCIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgtMS4zMzA4ODEzLDAsMCwxLjMzMDg4MTMsNzIuNTEzNzEyLC0xMC43MTY1MjQpIj4KICAgIDxwYXRoCiAgICAgICBpZD0icmVjdDI5ODUiCiAgICAgICBkPSJtIDE1LjM3NSw4LjYyNSBjIC0xLjQ3NTg5NCwwLjA2NzY1OSAtMi45NDE3MzMsMC42MTE2MTUzIC00LjEyNSwxLjYyNSAtMi43MDQ2MTE0LDIuMzE2MzA4IC0yLjg5ODI1MzcsNi4yMzUzOTggLTAuNDM3NSw4Ljc4MTI1IGwgMjIsMjIuNzUgOS44MTI1LC04LjMxMjUgLTIyLjA2MjUsLTIyLjgxMjUgQyAxOS4xNzgzMjYsOS4yMjQyMDggMTcuMjcyNTc4LDguNTM4MDEwNCAxNS4zNzUsOC42MjUgeiIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPHBhdGgKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjYyIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICBpZD0icmVjdDI5ODciCiAgICAgICBkPSJNIDMzLjc4MTI1LDI0LjU2MjUgOS41LDQ1LjM0Mzc1IGMgLTIuNzA0NjExNiwyLjMxNjMwOCAtMi44OTgyNTM3LDYuMjM1Mzk3IC0wLjQzNzUsOC43ODEyNSAyLjQ2MDc1MywyLjU0NTg1MiA2LjYwNzg4OSwyLjcyMjU1OCA5LjMxMjUsMC40MDYyNSBMIDQyLjQ3MTkyOCwzMy41MDE1ODkgQyA0Mi4zMTk5OTQsMzMuMzQyOCA0MS43Mzg3NDksMzMuOTUyMzc1IDQxLjU5Mzc1LDMzLjc4MTI1IHoiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIiAvPgogIDwvZz4KPC9zdmc+Cgo8c3ZnCnk9IjI1NiIKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIHZlcnNpb249IjEuMSIKICAgd2lkdGg9IjY0IgogICBoZWlnaHQ9IjY0IgogICBpZD0ic3ZnMzgwOSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC41IHIxMDA0MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iaWNvbl9wYWNrLnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzYzNjM2MyIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY3ODQzMTM3IgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMTA4IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwNTkiCiAgICAgaWQ9Im5hbWVkdmlldzI5OTgiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjUuMjE0OTEyNSIKICAgICBpbmtzY2FwZTpjeD0iMTUuMzgxNDU2IgogICAgIGlua3NjYXBlOmN5PSIzOS42MjgyNDQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlkPSJsYXllcjEiCiAgICAgc3R5bGU9InN0cm9rZTpub25lO2ZpbGw6I2ZmZmZmZiI+CiAgICA8ZwogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMC45MDQ1NDI4OCwwLDAsMC45MDQ1NDI4OCwtMjUwLjgxOTE3LC0yNTUuMzQ2NDYpIgogICAgICAgaWQ9ImczODkxIgogICAgICAgc3R5bGU9InN0cm9rZTpub25lO2ZpbGw6I2ZmZmZmZiI+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Im0gMjk3Ljg1ODAzLDI4My42MzYwOSBjIC0zLjEwNDE0LDAgLTUuNTgzNjgsMi41MDY3NyAtNS41ODM2OCw1LjYxMDkxIGwgMCw1MS42Njk0MiBjIDAsMy4xMDQxMyAyLjQ3OTU0LDUuNjEwOTEgNS41ODM2OCw1LjYxMDkxIGwgMzMuOTM3ODUsMCBjIDMuMTA0MTMsMCA1LjYxMDkxLC0yLjUwNjc4IDUuNjEwOTEsLTUuNjEwOTEgbCAwLC0zMC40Nzg3IC0wLjEwODk1LC0wLjEwODk0IGMgLTAuMDcwNSwtMC4yNjI3MyAtMC4xOTg2NiwtMC41MjY5NiAtMC40MDg1NiwtMC43MzU0MiBMIDMxMS4yNTg4NSwyODQuMTUzNiBjIC0wLjEwNjU2LC0wLjEwNTgzIC0wLjIyOTkyLC0wLjE3NTEgLTAuMzU0MDksLTAuMjQ1MTQgLTAuMDg1OCwtMC4wODc0IC0wLjE3MDUzLC0wLjE3NzY5IC0wLjI0NTE0LC0wLjI3MjM3IGwgLTEyLjgwMTU5LDAgeiBtIDEzLjQwMDgyLDQuNzkzNzggMjEuNDkwMzQsMjEuMzU0MTYgLTE1Ljg3OTQzLDAgYyAtMy4xMDQxNCwwIC01LjYxMDkxLC0yLjQ3OTU0IC01LjYxMDkxLC01LjU4MzY4IGwgMCwtMTUuNzcwNDggeiIKICAgICAgICAgaWQ9InBhdGgzODAyIgogICAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxLjc0MzE5NjAwOTk5OTk5OTkxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1vcGFjaXR5OjE7c3Ryb2tlLWRhc2hhcnJheTpub25lIiAvPgogICAgICA8cGF0aAogICAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIgogICAgICAgICBkPSJtIDI5My4zMDY0NywyODcuOTY3NTMgYyAtNC42NDI3MywtMC4xMzc3NyAtNi4zNjE0MSw1LjEyNTExIC01LjU4MTQ4LDguOTQ1MiAwLjA2MDIsMTYuNDk3MjUgLTAuMTM1MDQsMzMuMDA3MjQgMC4xMDEyNyw0OS40OTY1IDAuNzA0MzEsMy45MzAxOCA1LjExNDM2LDQuOTY0MTcgOC41MDgwNyw0LjQ0Njc5IDEwLjY5MzgsLTAuMDU5NCAyMS40MDExOCwwLjEzNzkxIDMyLjA4NjQyLC0wLjEwNDQ4IDMuNTM0MTYsLTAuNjQ5MjggNC45MzMxMSwtNC41NTU1MSA0LjQzNDQ4LC03Ljc1MDQzIDAsLTkuNDEwNjUgMCwtMTguODIxMjkgMCwtMjguMjMxOTMgLTEuMzIxNjksLTEuNzQ2NjIgLTQuMTc0NTcsLTEuMDgxMDggLTYuMTg4MTUsLTEuNjkxNjggLTUuMjA0NjQsLTAuNzc3NjkgLTEwLjQwOTI3LC0xLjU1NTM4IC0xNS42MTM5MSwtMi4zMzMwNyAtMS42NDI4NCwtNy40ODU1NCAtMy4wMzAxMSwtMTUuMDI0NzQgLTQuNjk5OTYsLTIyLjUwNDUyIC0zLjMyNjk0LC0wLjUzMjEgLTYuODMxOTEsLTAuMTYwNDYgLTEwLjI0MjY5LC0wLjI3MjM3IC0wLjkzNDY4LC0xMGUtNiAtMS44NjkzOSwxZS01IC0yLjgwNDA1LC0xMGUtNiB6IG0gOS42OTA5MiwxMy40ODU1NSBjIDQuNDQyODYsNS4yNDU0MyA4Ljg4NTcxLDEwLjQ5MDg3IDEzLjMyODU3LDE1LjczNjMgLTIuNzgxNTMsLTIuNjUzNjEgLTYuNjM2MTYsLTQuMTQwMjkgLTkuMTQ0MzQsLTYuOTMwMyAtMC45MTM3OSwtMy4xMzU0NCAtMi43NTYzLC01Ljg4NDc2IC00LjE4NDIzLC04LjgwNiB6IgogICAgICAgICBpZD0icmVjdDMwMTkiCiAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4KCjxzdmcKeT0iMzIwIgogICAKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgdmVyc2lvbj0iMS4xIgogICB3aWR0aD0iNjQiCiAgIGhlaWdodD0iNjQiCiAgIGlkPSJzdmczODA5IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29uX2Nyb3NzLnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzYzNjM2MyIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY3ODQzMTM3IgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSI5NTgiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1OSIKICAgICBpZD0ibmFtZWR2aWV3Mjk5OCIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iNS4yMTQ5MTI1IgogICAgIGlua3NjYXBlOmN4PSIxNS41MzY2NjYiCiAgICAgaW5rc2NhcGU6Y3k9IjI2LjAzNzczNSIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMCIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMTkiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmczODA5IiAvPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMzODExIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTM4MTQiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaWQ9ImczMDI0IgogICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMjkzNzc5NywwLDAsMS4yOTM3Nzk3LC03LjMzODkxMzcsLTkuNTE0ODg1NykiPgogICAgPHBhdGgKICAgICAgIGlkPSJyZWN0Mjk4NSIKICAgICAgIGQ9Im0gMTUuMzc1LDguNjI1IGMgLTEuNDc1ODk0LDAuMDY3NjU5IC0yLjk0MTczMywwLjYxMTYxNTMgLTQuMTI1LDEuNjI1IC0yLjcwNDYxMTQsMi4zMTYzMDggLTIuODk4MjUzNyw2LjIzNTM5OCAtMC40Mzc1LDguNzgxMjUgbCAyMiwyMi43NSA5LjgxMjUsLTguMzEyNSAtMjIuMDYyNSwtMjIuODEyNSBDIDE5LjE3ODMyNiw5LjIyNDIwOCAxNy4yNzI1NzgsOC41MzgwMTA0IDE1LjM3NSw4LjYyNSB6IgogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICA8cGF0aAogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY3NjY2NjIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJyZWN0Mjk4NyIKICAgICAgIGQ9Ik0gMzMuNzgxMjUsMjQuNTYyNSA5LjUsNDUuMzQzNzUgYyAtMi43MDQ2MTE2LDIuMzE2MzA4IC0yLjg5ODI1MzcsNi4yMzUzOTcgLTAuNDM3NSw4Ljc4MTI1IDIuNDYwNzUzLDIuNTQ1ODUyIDYuNjA3ODg5LDIuNzIyNTU4IDkuMzEyNSwwLjQwNjI1IEwgNDIuNDcxOTI4LDMzLjUwMTU4OSBDIDQyLjMxOTk5NCwzMy4zNDI4IDQxLjczODc0OSwzMy45NTIzNzUgNDEuNTkzNzUsMzMuNzgxMjUgeiIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiIC8+CiAgPC9nPgo8L3N2Zz4KCjxzdmcKeT0iMzg0IgogICAKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgdmVyc2lvbj0iMS4xIgogICB3aWR0aD0iNjQiCiAgIGhlaWdodD0iNjQiCiAgIGlkPSJzdmczODA5IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29uX2xlZnQuc3ZnIj4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjNjM2MzYzIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuNjc4NDMxMzciCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9Ijk1OCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDU5IgogICAgIGlkPSJuYW1lZHZpZXcyOTk4IgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIzLjY4NzUiCiAgICAgaW5rc2NhcGU6Y3g9IjQ0LjA3NjY3OSIKICAgICBpbmtzY2FwZTpjeT0iNzAuNTA2MjUiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8cGF0aAogICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgZD0iTSAyNi41NjI1IDEuNjU2MjUgQyAyNS4xMDgxNTcgMS43MjI5MjEyIDIzLjYyOTEzMyAyLjEzMDk1MiAyMi4zNDM3NSAyLjkwNjI1IEMgMjIuOTU4OTY2IDMuMjc5NDg2NCAyMy41NDQ0ODUgMy43NDUzMjA5IDI0LjA2MjUgNC4yODEyNSBMIDUyLjU5Mzc1IDMzLjc4MTI1IEwgNDguNDY4NzUgMzcuMjgxMjUgTCAyMS4yMTg3NSA2MS4wMzEyNSBDIDIwLjg1Nzk3MyA2MS4zNDAyMyAyMC40NTgxOTMgNjEuNjAzMjc3IDIwLjA2MjUgNjEuODQzNzUgQyAyMy4yMzI4ODMgNjMuNzg3NzQzIDI3LjQ5NjY1MyA2My41NDk4NzcgMzAuNDM3NSA2MS4wMzEyNSBMIDU3LjY4NzUgMzcuMjgxMjUgTCA2MS44MTI1IDMzLjc4MTI1IEwgMzMuMjgxMjUgNC4yODEyNSBDIDMxLjQ5MDQzIDIuNDI4NTAzMiAyOS4wMTc1NSAxLjU0MzcwNDYgMjYuNTYyNSAxLjY1NjI1IHogIgogICAgIGlkPSJwYXRoMzA2OCIgLz4KICA8ZwogICAgIGlkPSJnMzAyNCIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgxLjI5Mzc3OTcsMCwwLDEuMjkzNzc5NywtNy4zMzg5MTM3LC05LjUxNDg4NTcpIj4KICAgIDxwYXRoCiAgICAgICBpZD0icmVjdDI5ODUiCiAgICAgICBkPSJtIDE1LjM3NSw4LjYyNSBjIC0xLjQ3NTg5NCwwLjA2NzY1OSAtMi45NDE3MzMsMC42MTE2MTUzIC00LjEyNSwxLjYyNSAtMi43MDQ2MTE0LDIuMzE2MzA4IC0yLjg5ODI1MzcsNi4yMzUzOTggLTAuNDM3NSw4Ljc4MTI1IGwgMjIsMjIuNzUgOS44MTI1LC04LjMxMjUgLTIyLjA2MjUsLTIyLjgxMjUgQyAxOS4xNzgzMjYsOS4yMjQyMDggMTcuMjcyNTc4LDguNTM4MDEwNCAxNS4zNzUsOC42MjUgeiIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPHBhdGgKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjYyIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICBpZD0icmVjdDI5ODciCiAgICAgICBkPSJNIDMzLjc4MTI1LDI0LjU2MjUgOS41LDQ1LjM0Mzc1IGMgLTIuNzA0NjExNiwyLjMxNjMwOCAtMi44OTgyNTM3LDYuMjM1Mzk3IC0wLjQzNzUsOC43ODEyNSAyLjQ2MDc1MywyLjU0NTg1MiA2LjYwNzg4OSwyLjcyMjU1OCA5LjMxMjUsMC40MDYyNSBMIDQyLjQ3MTkyOCwzMy41MDE1ODkgQyA0Mi4zMTk5OTQsMzMuMzQyOCA0MS43Mzg3NDksMzMuOTUyMzc1IDQxLjU5Mzc1LDMzLjc4MTI1IHoiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIiAvPgogIDwvZz4KPC9zdmc+Cgo8c3ZnCnk9IjQ0OCIKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIHZlcnNpb249IjEuMSIKICAgd2lkdGg9IjY0IgogICBoZWlnaHQ9IjY0IgogICBpZD0ic3ZnMzgwOSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC41IHIxMDA0MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iaWNvbl9wbGF5LnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzYzNjM2MyIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY3ODQzMTM3IgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSI5NTgiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1OSIKICAgICBpZD0ibmFtZWR2aWV3Mjk5OCIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iMy42ODc1IgogICAgIGlua3NjYXBlOmN4PSI0NC4wNzY2NzkiCiAgICAgaW5rc2NhcGU6Y3k9IjcwLjUwNjI1IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIxOSIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9InN2ZzM4MDkiIC8+CiAgPGRlZnMKICAgICBpZD0iZGVmczM4MTEiIC8+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhMzgxNCI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGU+PC9kYzp0aXRsZT4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPHJlY3QKICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIgogICAgIGlkPSJyZWN0MzEwNCIKICAgICB3aWR0aD0iNTkuMTE4NjQ1IgogICAgIGhlaWdodD0iNTguMzA1MDg0IgogICAgIHg9IjIuNDQwNjc3OSIKICAgICB5PSIyLjQ0MDY3NzYiCiAgICAgcng9IjcuNzY4NjQ4MSIKICAgICByeT0iNS41ODU5NjgiIC8+Cjwvc3ZnPgoKPC9zdmc+);background-repeat:no-repeat;display:inline-block;width:64px;height:64px;z-index:1;margin-top:-16px;transform:scale(0.6)}.icon_cross:hover,.icon_cycle:hover,.icon_hdd:hover,.icon_left:hover,.icon_pack:hover,.icon_right:hover,.icon_play:hover,.icon_stop:hover{transform:scale(0.75);transition-duration:400ms}.icon_cross{background-position:0 0px}.icon_cycle{background-position:0 -64px}.icon_hdd{background-position:0 -128px}.icon_left{background-position:0 -192px}.icon_pack{background-position:0 -256px}.icon_right{background-position:0 -320px}.icon_play{background-position:0 -384px}.icon_stop{background-position:0 -448px}
        </style>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js"></script>
        <script type="text/javascript">
(function(){var debug=false;var root=this;var EXIF=function(obj){if(obj instanceof EXIF)return obj;if(!(this instanceof EXIF))return new EXIF(obj);this.EXIFwrapped=obj;};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=EXIF;}
exports.EXIF=EXIF;}else{root.EXIF=EXIF;}
var ExifTags=EXIF.Tags={0x9000:"ExifVersion",0xA000:"FlashpixVersion",0xA001:"ColorSpace",0xA002:"PixelXDimension",0xA003:"PixelYDimension",0x9101:"ComponentsConfiguration",0x9102:"CompressedBitsPerPixel",0x927C:"MakerNote",0x9286:"UserComment",0xA004:"RelatedSoundFile",0x9003:"DateTimeOriginal",0x9004:"DateTimeDigitized",0x9290:"SubsecTime",0x9291:"SubsecTimeOriginal",0x9292:"SubsecTimeDigitized",0x829A:"ExposureTime",0x829D:"FNumber",0x8822:"ExposureProgram",0x8824:"SpectralSensitivity",0x8827:"ISOSpeedRatings",0x8828:"OECF",0x9201:"ShutterSpeedValue",0x9202:"ApertureValue",0x9203:"BrightnessValue",0x9204:"ExposureBias",0x9205:"MaxApertureValue",0x9206:"SubjectDistance",0x9207:"MeteringMode",0x9208:"LightSource",0x9209:"Flash",0x9214:"SubjectArea",0x920A:"FocalLength",0xA20B:"FlashEnergy",0xA20C:"SpatialFrequencyResponse",0xA20E:"FocalPlaneXResolution",0xA20F:"FocalPlaneYResolution",0xA210:"FocalPlaneResolutionUnit",0xA214:"SubjectLocation",0xA215:"ExposureIndex",0xA217:"SensingMethod",0xA300:"FileSource",0xA301:"SceneType",0xA302:"CFAPattern",0xA401:"CustomRendered",0xA402:"ExposureMode",0xA403:"WhiteBalance",0xA404:"DigitalZoomRation",0xA405:"FocalLengthIn35mmFilm",0xA406:"SceneCaptureType",0xA407:"GainControl",0xA408:"Contrast",0xA409:"Saturation",0xA40A:"Sharpness",0xA40B:"DeviceSettingDescription",0xA40C:"SubjectDistanceRange",0xA005:"InteroperabilityIFDPointer",0xA420:"ImageUniqueID"};var TiffTags=EXIF.TiffTags={0x0100:"ImageWidth",0x0101:"ImageHeight",0x8769:"ExifIFDPointer",0x8825:"GPSInfoIFDPointer",0xA005:"InteroperabilityIFDPointer",0x0102:"BitsPerSample",0x0103:"Compression",0x0106:"PhotometricInterpretation",0x0112:"Orientation",0x0115:"SamplesPerPixel",0x011C:"PlanarConfiguration",0x0212:"YCbCrSubSampling",0x0213:"YCbCrPositioning",0x011A:"XResolution",0x011B:"YResolution",0x0128:"ResolutionUnit",0x0111:"StripOffsets",0x0116:"RowsPerStrip",0x0117:"StripByteCounts",0x0201:"JPEGInterchangeFormat",0x0202:"JPEGInterchangeFormatLength",0x012D:"TransferFunction",0x013E:"WhitePoint",0x013F:"PrimaryChromaticities",0x0211:"YCbCrCoefficients",0x0214:"ReferenceBlackWhite",0x0132:"DateTime",0x010E:"ImageDescription",0x010F:"Make",0x0110:"Model",0x0131:"Software",0x013B:"Artist",0x8298:"Copyright"};var GPSTags=EXIF.GPSTags={0x0000:"GPSVersionID",0x0001:"GPSLatitudeRef",0x0002:"GPSLatitude",0x0003:"GPSLongitudeRef",0x0004:"GPSLongitude",0x0005:"GPSAltitudeRef",0x0006:"GPSAltitude",0x0007:"GPSTimeStamp",0x0008:"GPSSatellites",0x0009:"GPSStatus",0x000A:"GPSMeasureMode",0x000B:"GPSDOP",0x000C:"GPSSpeedRef",0x000D:"GPSSpeed",0x000E:"GPSTrackRef",0x000F:"GPSTrack",0x0010:"GPSImgDirectionRef",0x0011:"GPSImgDirection",0x0012:"GPSMapDatum",0x0013:"GPSDestLatitudeRef",0x0014:"GPSDestLatitude",0x0015:"GPSDestLongitudeRef",0x0016:"GPSDestLongitude",0x0017:"GPSDestBearingRef",0x0018:"GPSDestBearing",0x0019:"GPSDestDistanceRef",0x001A:"GPSDestDistance",0x001B:"GPSProcessingMethod",0x001C:"GPSAreaInformation",0x001D:"GPSDateStamp",0x001E:"GPSDifferential"};var StringValues=EXIF.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0x0000:"Flash did not fire",0x0001:"Flash fired",0x0005:"Strobe return light not detected",0x0007:"Strobe return light detected",0x0009:"Flash fired, compulsory flash mode",0x000D:"Flash fired, compulsory flash mode, return light not detected",0x000F:"Flash fired, compulsory flash mode, return light detected",0x0010:"Flash did not fire, compulsory flash mode",0x0018:"Flash did not fire, auto mode",0x0019:"Flash fired, auto mode",0x001D:"Flash fired, auto mode, return light not detected",0x001F:"Flash fired, auto mode, return light detected",0x0020:"No flash function",0x0041:"Flash fired, red-eye reduction mode",0x0045:"Flash fired, red-eye reduction mode, return light not detected",0x0047:"Flash fired, red-eye reduction mode, return light detected",0x0049:"Flash fired, compulsory flash mode, red-eye reduction mode",0x004D:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",0x004F:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",0x0059:"Flash fired, auto mode, red-eye reduction mode",0x005D:"Flash fired, auto mode, return light not detected, red-eye reduction mode",0x005F:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function addEvent(element,event,handler){if(element.addEventListener){element.addEventListener(event,handler,false);}else if(element.attachEvent){element.attachEvent("on"+event,handler);}}
function imageHasData(img){return!!(img.exifdata);}
function base64ToArrayBuffer(base64,contentType){contentType=contentType||base64.match(/^data\\:([^\\;]+)\\;base64,/mi)[1]||'';base64=base64.replace(/^data\\:([^\\;]+)\\;base64,/gmi,'');var binary=atob(base64);var len=binary.length;var buffer=new ArrayBuffer(len);var view=new Uint8Array(buffer);for(var i=0;i<len;i++){view[i]=binary.charCodeAt(i);}
return buffer;}
function objectURLToBlob(url,callback){var http=new XMLHttpRequest();http.open("GET",url,true);http.responseType="blob";http.onload=function(e){if(this.status==200||this.status===0){callback(this.response);}};http.send();}
function getImageData(img,callback){function handleBinaryFile(binFile){var data=findEXIFinJPEG(binFile);var iptcdata=findIPTCinJPEG(binFile);img.exifdata=data||{};img.iptcdata=iptcdata||{};if(callback){callback.call(img);}}
if(img.src){if(/^data\\:/i.test(img.src)){var arrayBuffer=base64ToArrayBuffer(img.src);handleBinaryFile(arrayBuffer);}else if(/^blob\\:/i.test(img.src)){var fileReader=new FileReader();fileReader.onload=function(e){handleBinaryFile(e.target.result);};objectURLToBlob(img.src,function(blob){fileReader.readAsArrayBuffer(blob);});}else{var http=new XMLHttpRequest();http.onload=function(){if(this.status==200||this.status===0){handleBinaryFile(http.response);}else{throw"Could not load image";}
http=null;};http.open("GET",img.src,true);http.responseType="arraybuffer";http.send(null);}}else if(window.FileReader&&(img instanceof window.Blob||img instanceof window.File)){var fileReader=new FileReader();fileReader.onload=function(e){if(debug)console.log("Got file of length "+e.target.result.byteLength);handleBinaryFile(e.target.result);};fileReader.readAsArrayBuffer(img);}}
function findEXIFinJPEG(file){var dataView=new DataView(file);if(debug)console.log("Got file of length "+file.byteLength);if((dataView.getUint8(0)!=0xFF)||(dataView.getUint8(1)!=0xD8)){if(debug)console.log("Not a valid JPEG");return false;}
var offset=2,length=file.byteLength,marker;while(offset<length){if(dataView.getUint8(offset)!=0xFF){if(debug)console.log("Not a valid marker at offset "+offset+", found: "+dataView.getUint8(offset));return false;}
marker=dataView.getUint8(offset+1);if(debug)console.log(marker);if(marker==225){if(debug)console.log("Found 0xFFE1 marker");return readEXIFData(dataView,offset+4,dataView.getUint16(offset+2)-2);}else{offset+=2+dataView.getUint16(offset+2);}}}
function findIPTCinJPEG(file){var dataView=new DataView(file);if(debug)console.log("Got file of length "+file.byteLength);if((dataView.getUint8(0)!=0xFF)||(dataView.getUint8(1)!=0xD8)){if(debug)console.log("Not a valid JPEG");return false;}
var offset=2,length=file.byteLength;var isFieldSegmentStart=function(dataView,offset){return(dataView.getUint8(offset)===0x38&&dataView.getUint8(offset+1)===0x42&&dataView.getUint8(offset+2)===0x49&&dataView.getUint8(offset+3)===0x4D&&dataView.getUint8(offset+4)===0x04&&dataView.getUint8(offset+5)===0x04);};while(offset<length){if(isFieldSegmentStart(dataView,offset)){var nameHeaderLength=dataView.getUint8(offset+7);if(nameHeaderLength%2!==0)nameHeaderLength+=1;if(nameHeaderLength===0){nameHeaderLength=4;}
var startOffset=offset+8+nameHeaderLength;var sectionLength=dataView.getUint16(offset+6+nameHeaderLength);return readIPTCData(file,startOffset,sectionLength);break;}
offset++;}}
var IptcFieldMap={0x78:'caption',0x6E:'credit',0x19:'keywords',0x37:'dateCreated',0x50:'byline',0x55:'bylineTitle',0x7A:'captionWriter',0x69:'headline',0x74:'copyright',0x0F:'category'};function readIPTCData(file,startOffset,sectionLength){var dataView=new DataView(file);var data={};var fieldValue,fieldName,dataSize,segmentType,segmentSize;var segmentStartPos=startOffset;while(segmentStartPos<startOffset+sectionLength){if(dataView.getUint8(segmentStartPos)===0x1C&&dataView.getUint8(segmentStartPos+1)===0x02){segmentType=dataView.getUint8(segmentStartPos+2);if(segmentType in IptcFieldMap){dataSize=dataView.getInt16(segmentStartPos+3);segmentSize=dataSize+5;fieldName=IptcFieldMap[segmentType];fieldValue=getStringFromDB(dataView,segmentStartPos+5,dataSize);if(data.hasOwnProperty(fieldName)){if(data[fieldName]instanceof Array){data[fieldName].push(fieldValue);}
else{data[fieldName]=[data[fieldName],fieldValue];}}
else{data[fieldName]=fieldValue;}}}
segmentStartPos++;}
return data;}
function readTags(file,tiffStart,dirStart,strings,bigEnd){var entries=file.getUint16(dirStart,!bigEnd),tags={},entryOffset,tag,i;for(i=0;i<entries;i++){entryOffset=dirStart+i*12+2;tag=strings[file.getUint16(entryOffset,!bigEnd)];if(!tag&&debug)console.log("Unknown tag: "+file.getUint16(entryOffset,!bigEnd));tags[tag]=readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd);}
return tags;}
function readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd){var type=file.getUint16(entryOffset+2,!bigEnd),numValues=file.getUint32(entryOffset+4,!bigEnd),valueOffset=file.getUint32(entryOffset+8,!bigEnd)+tiffStart,offset,vals,val,n,numerator,denominator;switch(type){case 1:case 7:if(numValues==1){return file.getUint8(entryOffset+8,!bigEnd);}else{offset=numValues>4?valueOffset:(entryOffset+8);vals=[];for(n=0;n<numValues;n++){vals[n]=file.getUint8(offset+n);}
return vals;}
case 2:offset=numValues>4?valueOffset:(entryOffset+8);return getStringFromDB(file,offset,numValues-1);case 3:if(numValues==1){return file.getUint16(entryOffset+8,!bigEnd);}else{offset=numValues>2?valueOffset:(entryOffset+8);vals=[];for(n=0;n<numValues;n++){vals[n]=file.getUint16(offset+2*n,!bigEnd);}
return vals;}
case 4:if(numValues==1){return file.getUint32(entryOffset+8,!bigEnd);}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getUint32(valueOffset+4*n,!bigEnd);}
return vals;}
case 5:if(numValues==1){numerator=file.getUint32(valueOffset,!bigEnd);denominator=file.getUint32(valueOffset+4,!bigEnd);val=new Number(numerator/denominator);val.numerator=numerator;val.denominator=denominator;return val;}else{vals=[];for(n=0;n<numValues;n++){numerator=file.getUint32(valueOffset+8*n,!bigEnd);denominator=file.getUint32(valueOffset+4+8*n,!bigEnd);vals[n]=new Number(numerator/denominator);vals[n].numerator=numerator;vals[n].denominator=denominator;}
return vals;}
case 9:if(numValues==1){return file.getInt32(entryOffset+8,!bigEnd);}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getInt32(valueOffset+4*n,!bigEnd);}
return vals;}
case 10:if(numValues==1){return file.getInt32(valueOffset,!bigEnd)/file.getInt32(valueOffset+4,!bigEnd);}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getInt32(valueOffset+8*n,!bigEnd)/file.getInt32(valueOffset+4+8*n,!bigEnd);}
return vals;}}}
function getStringFromDB(buffer,start,length){var outstr="";for(n=start;n<start+length;n++){outstr+=String.fromCharCode(buffer.getUint8(n));}
return outstr;}
function readEXIFData(file,start){if(getStringFromDB(file,start,4)!="Exif"){if(debug)console.log("Not valid EXIF data! "+getStringFromDB(file,start,4));return false;}
var bigEnd,tags,tag,exifData,gpsData,tiffOffset=start+6;if(file.getUint16(tiffOffset)==0x4949){bigEnd=false;}else if(file.getUint16(tiffOffset)==0x4D4D){bigEnd=true;}else{if(debug)console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)");return false;}
if(file.getUint16(tiffOffset+2,!bigEnd)!=0x002A){if(debug)console.log("Not valid TIFF data! (no 0x002A)");return false;}
var firstIFDOffset=file.getUint32(tiffOffset+4,!bigEnd);if(firstIFDOffset<0x00000008){if(debug)console.log("Not valid TIFF data! (First offset less than 8)",file.getUint32(tiffOffset+4,!bigEnd));return false;}
tags=readTags(file,tiffOffset,tiffOffset+firstIFDOffset,TiffTags,bigEnd);if(tags.ExifIFDPointer){exifData=readTags(file,tiffOffset,tiffOffset+tags.ExifIFDPointer,ExifTags,bigEnd);for(tag in exifData){switch(tag){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":exifData[tag]=StringValues[tag][exifData[tag]];break;case"ExifVersion":case"FlashpixVersion":exifData[tag]=String.fromCharCode(exifData[tag][0],exifData[tag][1],exifData[tag][2],exifData[tag][3]);break;case"ComponentsConfiguration":exifData[tag]=StringValues.Components[exifData[tag][0]]+
StringValues.Components[exifData[tag][1]]+
StringValues.Components[exifData[tag][2]]+
StringValues.Components[exifData[tag][3]];break;}
tags[tag]=exifData[tag];}}
if(tags.GPSInfoIFDPointer){gpsData=readTags(file,tiffOffset,tiffOffset+tags.GPSInfoIFDPointer,GPSTags,bigEnd);for(tag in gpsData){switch(tag){case"GPSVersionID":gpsData[tag]=gpsData[tag][0]+"."+gpsData[tag][1]+"."+gpsData[tag][2]+"."+gpsData[tag][3];break;}
tags[tag]=gpsData[tag];}}
return tags;}
EXIF.getData=function(img,callback){if((img instanceof Image||img instanceof HTMLImageElement)&&!img.complete)return false;if(!imageHasData(img)){getImageData(img,callback);}else{if(callback){callback.call(img);}}
return true;}
EXIF.getTag=function(img,tag){if(!imageHasData(img))return;return img.exifdata[tag];}
EXIF.getAllTags=function(img){if(!imageHasData(img))return{};var a,data=img.exifdata,tags={};for(a in data){if(data.hasOwnProperty(a)){tags[a]=data[a];}}
return tags;}
EXIF.pretty=function(img){if(!imageHasData(img))return"";var a,data=img.exifdata,strPretty="";for(a in data){if(data.hasOwnProperty(a)){if(typeof data[a]=="object"){if(data[a]instanceof Number){strPretty+=a+" : "+data[a]+" ["+data[a].numerator+"/"+data[a].denominator+"]\\r\\n";}else{strPretty+=a+" : ["+data[a].length+" values]\\r\\n";}}else{strPretty+=a+" : "+data[a]+"\\r\\n";}}}
return strPretty;}
EXIF.readFromBinaryFile=function(file){return findEXIFinJPEG(file);}
if(typeof define==='function'&&define.amd){define('exif-js',[],function(){return EXIF;});}}.call(this));" use strict "
var INFINISCROLL={{{INFINISCROLL}}};var data={};var pass='';var page_size={{{PAGE_SIZE}}};var cur_image=0;var isotope=0;var popup_delay=3000;var _popups=[];var _cur_popup=0;var expertise_level=0;function display_popup(content,opts){var opts=opts||{};var flush=!!opts.flush;if(_cur_popup!=0&&!flush){if(_cur_popup&&!(_popups.length>0&&content!=_popups[_popups.length-1][0])){_popups.push([content,opts])}}else{if(flush)
_popups=[];if(_cur_popup!=0)
clearTimeout(_cur_popup);var o=QS('#popup');o.innerHTML=content;o.classList.remove("slide-down");if(!!!opts.stay){_cur_popup=setTimeout(remove_popup,popup_delay);}
if(!!opts.onshow)
opts.onshow();}}
function remove_popup(){var o=QS('#popup');clearTimeout(_cur_popup);_cur_popup=0;if(_popups.length!=0){var content=_popups.pop();display_popup(content[0],content[1]);}else{o.classList.add('slide-down');}}
var DC=function(query,klass){var q=document.querySelector(query);if(q)
q.classList.remove(klass);};var DCA=function(query,klass){var q=document.querySelectorAll(query);for(var i=0;i<q.length;i++){q[i].classList.remove(klass);}};var AC=function(query,klass){var q=document.querySelectorAll(query);for(var i=0;i<q.length;i++){q[i].classList.add(klass);}};var QSA=function(query){return document.querySelectorAll(query);};var QS=function(query){return document.querySelector(query);};var CE=function(tag){return document.createElement(tag);}
var randomize=function(){var x=document.querySelectorAll('div.item')
var d=16;for(var i=0;i<x.length;i++){x[i].style['transform']='rotateZ('+(d/2-d*Math.random())+'deg)'};}
var switch_page=function(nr){isotope.arrange({filter:'.p'+nr});DCA('button','current');QSA('button')[nr].classList.add('current');}
var _set_left_image=function(url){_image_setters.prev=0;setTimeout(function(){QS('#prev_projected').src=url;},550);}
var _set_right_image=function(url){_image_setters.next=0;setTimeout(function(){QS('#next_projected').src=url;},500);}
var _set_image=function(){const fname=data[cur_image].f;_image_setters.cur=0;if(fname.match(/.*mp4/)){QS('#projected').style.display="none";QS('#projected_video').style.display="block";QS('#projected_video').src=pass+'/'+fname;}else{QS('#projected').style.display="block";QS('#projected_video').style.display="none";QS('#projected').src=pass+'/'+fname;var txt=data[cur_image].f.replace(/.*[/]/,'');txt+=' ('+(1+cur_image)+'/'+data.length+')';QS('#projected_name').textContent=txt;}}
var slideshow_id=false;var _start_show=function(){var slideshow_delay=Math.floor(parseFloat(QS('#delay').value)*1000);slideshow_id=setTimeout(next_image,slideshow_delay);}
var _slideshow_pressed=0;function show(list){for(var i=0;i<list.length;i++){QS(list[i]).style.visibility="";}}
function hide(list){for(var i=0;i<list.length;i++){QS(list[i]).style.visibility="hidden";}}
var slideshow_button=function(){if(_slideshow_pressed){clearTimeout(_slideshow_pressed);_slideshow_pressed=0;}
var p=QS('#projected');if(slideshow_id){clearTimeout(slideshow_id);slideshow_id=false;show(['#projected_name','#next_button','#prev_button']);QS('#slide_button').classList.remove('icon_stop');QS('#slide_button').classList.add('icon_play');p.style.transform='translate(0, 0) scale(1.0)';setTimeout(_set_image,300);}else{hide(['#projected_name','#next_button','#prev_button']);QS('#slide_button').classList.remove('icon_play');QS('#slide_button').classList.add('icon_stop');slideshow_id=1;_slideshow_pressed=setTimeout(next_image,1300);p.style.transform='translate(0, 0) scale(1.1)';setTimeout(function(){p.style.transform='translate(0, -16px) scale(1.1)';},300);}}
var _image_setters={'cur':0,'prev':0,'next':0}
var view_image=function(obj,counter){if(expertise_level==0){display_popup('Click on the "play" icon to start slideshow, you can use ARROWS and ESCAPE here');expertise_level++;}
cur_image=counter;if(QS('#projector').classList.contains('slide-down')){QS('div#container').style.visibility='hidden';DC('#projector','slide-down');QS('#projected').src=pass+'/'+data[cur_image].t;}
if(!!_image_setters.cur){clearTimeout(_image_setters.cur)
clearTimeout(_image_setters.prev)
clearTimeout(_image_setters.next)}
_image_setters.cur=setTimeout(_set_image,250);if(counter+1<data.length)
_image_setters.next=setTimeout(function(){_set_right_image(pass+'/'+data[counter+1].f)},251);if(counter-1>0)
_image_setters.next=setTimeout(function(){_set_left_image(pass+'/'+data[counter-1].f)},252);}
var next_image=function(user_action){var user_action=user_action||false;if(user_action&&!!slideshow_id){if(cur_image+1<data.length)
cur_image++;slideshow_button();}else{if(cur_image+1<data.length){if(cur_image>0)
_set_left_image(pass+'/'+data[cur_image].f);QS('#next_button').classList.add('busy');setTimeout(function(){cur_image++;_set_image();if(cur_image+1<data.length){_set_right_image(pass+'/'+data[cur_image+1].f);}},10);}else{if(!!slideshow_id){_set_image();slideshow_button();}else{display_popup('<button id="replaybut" onclick="cur_image = -1; next_image()">Replay</button>');}}}}
var prev_image=function(user_action){var user_action=user_action||false;if(!!QS('#replaybut'))
remove_popup();if(user_action&&!!slideshow_id){if(cur_image>0)
cur_image--;slideshow_button();}else{if(cur_image>0){AC('#prev_button','busy');setTimeout(function(){_set_right_image(pass+'/'+data[cur_image].f);cur_image--;if(cur_image>0){_set_left_image(pass+'/'+data[cur_image-1].f);}
_set_image();},10);}}}
var close_projector=function(){AC('#projector','slide-down');QS('div#container').style.visibility='visible';AC('#projected','loading');if(slideshow_id)slideshow_button();}
var expected_loads=null;function notify_loaded(img){if(expected_loads--<=1){isotope.arrange();setTimeout(function(){if(QSA('div.item')[2].style.left=="0px"){isotope.arrange()}},1);}}
function start_process(){var container=QS('#container');isotope=new Isotope(container,{itemSelector:'.item',isFitWidth:true,filter:(INFINISCROLL?false:'.p0')});isotope.on('layoutComplete',randomize);QS('#dl_ref').style.visibility="hidden";QS('#dl_ref').setAttribute('href','./'+pass+'/package.zip');var xhr=new XMLHttpRequest();xhr.open('GET','./'+pass+'/images.js',true);xhr.overrideMimeType('text/javascript; charset=utf-8');if(INFINISCROLL)
QS('#pages').style.visibility='hidden';xhr.onreadystatechange=function(e){if(this.readyState==4&&this.status==200){data=JSON.parse(this.responseText);if(!!data.version){data=uncompress_resources(data);}
var pages=QS('#pages #page_list');for(var i=0;i<data.length;i=i+page_size){var p=i/page_size;var btn=CE('button');btn.onclick=function(){var page=p;return function(){switch_page(page)};}();btn.innerHTML='&nbsp;'+(p+1)+'&nbsp;';pages.appendChild(btn);};var html=[];var d={};var counter=0;for(var i in data){d=data[i];if(!!!d.s){var size='';}else{if(d.s>1100000){var size="&nbsp;"+(Math.floor(d.s/1000)/1000.0)+" MB";}else{var size="&nbsp;"+Math.floor(d.s/1000)+" kB";}}
html.push('<div title="'+d.f+size+'" class="item p'+Math.floor(counter/page_size)+'" ><img class="tn" onclick="view_image(this, '+counter+')" src="'+pass+'/'+d.t+'" ></img></div>');counter++;};expected_loads=html.length;for(var i=0;i<html.length;i++){var d=CE('div');d.innerHTML=html[i];var image=d.querySelector('div.item > img');if(image.complete){notify_loaded(image);}else{image.onload=notify_loaded;}
isotope.element.appendChild(d.children[0]);}
isotope.appended(document.querySelectorAll('div.item'));if(data.length>page_size)
QS('button').classList.add('current');QS('#dl_ref').style.visibility="visible";}else if(this.readyState==4){display_popup("<h1>Error loading images</h1>Perhaps the code is incorrect.",{'flush':true});QS('#dl_ref').style.visibility="hidden";change_code();}};xhr.send(null);QS('#projected').onload=function(e){DC('button.busy','busy');DC('#projected','loading');if(!!slideshow_id){_start_show();}};document.onkeydown=function(e){switch(e.which){case 27:if(!!slideshow_id){slideshow_button();}else{close_projector();}
break;case 37:prev_image(true);break;case 38:prev_image(true);break;case 39:next_image(true);break;case 40:next_image(true);break;default:return;}
e.preventDefault();};if(expertise_level==0)
display_popup('Welcome ! Click on an image to launch the viewer !');}
function _start_bootstrap(code){remove_popup();pass=code||QS("#codepopup input").value;start_process();}
function change_code(){QS('#container').innerHTML='';QS('#page_list').innerHTML='';display_popup('<form action="#" onsubmit="_start_bootstrap(); return false;" id="codepopup" >Code: <input type="text" ></input></form>',{'stay':true,onshow:function(){QS('#codepopup input').focus()}});}
function uncompress_resources(keys_values_array){var keys=keys_values_array.c;var list_of_values=keys_values_array.r;var ret=[];for(var i=0;i<list_of_values.length;i++){var values=list_of_values[i];var item={};for(var pid=0;pid<keys.length;pid++){item[keys[pid]]=values[pid];}
ret.push(item);}
return ret;};function show_exif(img){EXIF.getData(img,function(){var expo=EXIF.getTag(img,"ExposureTime");if(expo!==undefined){if(expo<0.5){expo="1/"+(1/expo)}
display_popup("ISO "+EXIF.getTag(img,"ISOSpeedRatings")+"<br/>f="+EXIF.getTag(img,"FocalLength")+"mm<br/>f/"+EXIF.getTag(img,"FNumber")+"<br/>"+expo+"s",{flush:true});}
img.exifdata=undefined;})}
var default_configuration={}
document.addEventListener('DOMContentLoaded',function(){var options=document.location.href.match('.*#(.*)');if(!!options){options=options[1].split(/ *,/);var tmp=null;for(var i=0;i<options.length;i++){tmp=options[i].split(/=/);default_configuration[tmp[0]]=tmp[1]}}
if(!!!default_configuration.code){display_popup('<form action="#" onsubmit="_start_bootstrap(); return false;" id="codepopup" >Code: <input type="text" ></input></form>',{'stay':true});QS('#codepopup input').focus();}else{_start_bootstrap(default_configuration.code);}});
        </script>
    </head>
    <body>
        <div id="global_container">
            <span class="pull-right"><h1><a id="dl_ref" style="visibility:hidden;" title="Download all images" class="bg_caption" href=""><div class="icon_hdd action_icon" ></div></a>&nbsp;<a class="bg_caption" href="#" title="Change current code" onclick="change_code()"><div class="icon_cycle action_icon" ></div></a></h1></span>
            <div id="pages"><span class="bg_caption"><span id="page_list" /></div>
            <hr />
            <div id="container">
            </div>
            <div id="popup"  class="slide-down">
            </div>
            <div id="projector"  class="slide-down">
                <div class="pull-right bigfont icon_cross action_icon" title="Close image viewer" onclick="close_projector()"></div>
                <span class="pull-right"><form action="#" onclick="return false;"><input class="bigfont" title="Slideshow delay" type="text" id="delay" size="3" value="3.5"></input>&nbsp;<div id="slide_button" class="bigfont icon_play action_icon" title="Toggle slideshow mode" onclick="slideshow_button(); false;"></div></form></span>
                <h1 id="projected_name">IMG XXX</h1>
                <br />
                <div id="next_button" title="Show next image" onclick="next_image(true)" class="pull-right bigfont icon_right action_icon"></div>
                <div id="prev_button" title="Show previous image" onclick="prev_image(true)" class="bigfont icon_left action_icon"></div>
                <video id="projected_video" width="auto" height="auto" controls>
                    <source src="movie.mp4" type="video/mp4">
                    <source src="movie.ogg" type="video/ogg">
                    Your browser does not support the video tag.
                </video>
                <img title="Use Arrow keys to change current image" id="projected" class="loading" onclick="show_exif(this)" />
                <img class="cache" id="next_projected" />
                <img class="cache" id="prev_projected" />
            </div>
        </div>
    </body>
</html>
"""

if __name__ == "__main__":
    import argparse

    parser = argparse.ArgumentParser(description='Make HTML5 Photo gallery.')
    parser.add_argument('input', metavar='FOLDER', type=str, help='folder with original images')
    parser.add_argument('-o', '--output', metavar='FOLDER', type=str, help='destination folder')
    parser.add_argument('-f', '--overwrite', action='store_true', help='overwrite files', default=False)
    parser.add_argument('-c', '--copy', action='store_true', help='copy original images', default=False)
    parser.add_argument('-s', '--resize', metavar='SIZE', action='store', help='resize original images when copying (give a maximum width or height in pixels, i.e: "1280") -- Implies "-c"', default=False)
    parser.add_argument('-t', '--thumb-size', metavar='SIZE', action='store', help='size of the generated thumbnails (give a maximum width or height in pixels, i.e: "200")', default=False)
    parser.add_argument('-q', '--quality', metavar='QUALITY', action='store', type=int, help='Output image quality in range [0-100]', default=90)
    parser.add_argument('-i', '--infiniscroll', action='store_true', help='Enable infiniscroll (single page)', default=False)
    parser.add_argument('-p', '--page-size', action='store', help='Number of thumbnail per page', default=25)
    args = parser.parse_args()

    if args.resize and not args.copy:
        args.copy = True

    INDEX = INDEX.replace('{{{INFINISCROLL}}}', str(args.infiniscroll).lower()).replace('{{{PAGE_SIZE}}}', str(args.page_size))


    print("Listing...")
    images  = ImageList(args.input, overwrite=args.overwrite)
    if len(images) == 0:
        print('\nError: No image found.')
        raise SystemExit(1)
    out = Output(args.output or args.input)
    if not os.path.exists(out.path):
        os.makedirs(out.path)
    print("\nWriting web page")
    w = HTMLWriter(images, out)
    w.write()
    w = JSONWriter(images, out)
    w.write()
    package_files = []
    if args.copy:
        noop = args.input == args.output
        img_mgr = ImageHandler()
        print("\nCopying...")
        sz = int(args.resize)
        for i, fname in enumerate(images.filenames):
            print('\r' + progress_maker(i, len(images.filenames)), end='')
            out_fname = os.path.join(out.path, os.path.basename(fname))
            package_files.append( out_fname )
            if noop or ( os.path.exists(out_fname) and not args.overwrite):
                continue
            rot = img_mgr.get_rotation(fname)
            if args.resize:
                src_img = img_mgr.minify( fname , sz )
                img_mgr.current_img = src_img
            src_img = img_mgr.rotate( fname, rot )
            img_mgr.save( src_img, out_fname, quality=args.quality)


    print("\nMaking thumbnails...")
    images.make_thumbs(out,args.thumb_size and int(args.thumb_size)) # TODO: re-use scaled+rotated images instead of originals

    zfname = os.path.join(out.path, 'package.zip')

    if not os.path.exists(zfname) or args.overwrite:
        print("\nZipping...")
        import zipfile
        z = zipfile.ZipFile( zfname, 'w')
        for i, fname in enumerate(package_files or images.filenames):
            print('\r' + progress_maker(i, len(images.filenames)), end='')
            z.write( fname, os.path.basename(fname) )
        z.close()

    print("\n%d files processed."%len(images))
    open(os.path.join(out.path, os.path.pardir, 'index.html'), 'w').write(INDEX)

