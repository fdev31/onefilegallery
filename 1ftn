#!/usr/bin/env python
from __future__ import print_function
import os
import sys

TMP='/tmp/'

class FatalError(SystemExit): pass

def progress_maker(cur, maxi):
    if cur == maxi:
        return ' Done!'
    return '%5.1f%%'%((cur*100.0/maxi))


def dontloadtwice(decorated):
    def _decorator(self, img=None, *args, **kw):
        if isinstance(img, str):
            if self.current_img_name != img:
                self.current_img_name = img
                img = self.current_img = self._load(img)
            else:
                img = self.current_img
        img = decorated(self, img or self.current_img, *args, **kw )
        return img
    return _decorator


class BaseImageHandler:

    MAX_SZ = 200 # pixels

    _rot_map = {
            6: 270,
            8: 90,
            1: 0,
        }

    def __init__(self):
        self.current_img_name = ''

    @dontloadtwice
    def get_rotation(self, img):
        r = self._exif_rot(img)
        if r:
            return self._rot_map[r]
        return 0

class JpegTranHandler(BaseImageHandler):

    _rot_map = {
            6: 270,
            8: -90,
            1: 0,
        }

    def _load(self, img):
        return jpegtran.JPEGImage( img )

    def _exif_rot(self, img):
        return img.exif_orientation

    @dontloadtwice
    def minify(self, img, size=None):
        w, h = img.width, img.height
        size = size or self.MAX_SZ
        if w > h:
            aspect = h/w
            nw = size
            nh = int(aspect * size)
        else:
            aspect = w/h
            nh = size
            wh = int(aspect * size)
        img = img.downscale(nw, nh)
        return img

    @dontloadtwice
    def save(self, img, path, quality):
        return img.save(path)

    @dontloadtwice
    def rotate(self, img, angle):
        if angle:
            return img.rotate(angle)
        return img


class PILHandler(BaseImageHandler):
    def _load(self, img):
        return Image.open( img )

    def _exif_rot(self, img):
        e = img._getexif()
        if e:
            return e[274]

    @dontloadtwice
    def rotate(self, img, angle):
        if angle:
            return img.rotate(angle)
        return img


    @dontloadtwice
    def minify(self, img, size=None):
        sz = size or self.MAX_SZ
        imgcopy = img
#        imgcopy = img.copy() # XXX: commenting this is a bug that is a speed boost
        imgcopy.thumbnail( (sz, sz), Image.ANTIALIAS )
        return imgcopy

    @dontloadtwice
    def save(self,img , path, quality):
        img = img.save( path, quality=quality, progressive=True, optimize=True)
        return img

try:
    import jpegtran
    ImageHandler = JpegTranHandler
except:
    from PIL import Image
    ImageHandler = PILHandler

class ImageList:

    filenames = []
    infos = []

    def __init__(self, path, overwrite=False):
        files = [fname for fname in os.listdir(path) if fname.rsplit('.')[-1].lower() in ('jpg', 'jpeg')]
        files.sort()
        filenames = []
        infos = []
        for i, name in enumerate(files):
            print('\r' + progress_maker(i, len(files)), end='')
            fullpath = os.path.join(path, name)
            filenames.append(fullpath)
            infos.append(dict(t='tn/'+name, f=name, s=os.stat(fullpath).st_size)) # more info to come ?
        print('\r' + progress_maker(len(files), len(files)), end='')
        self.filenames = filenames
        self.infos = infos
        self.overwrite = overwrite

    def __len__(self):
        return len(self.filenames)

    def make_thumbs(self, out):
        tn_path = os.path.join(out.path, 'tn')
        img_mgr = ImageHandler()
        if not os.path.isdir(tn_path):
            try:
                os.makedirs( tn_path )
            except OSError:
                print('%s must be a valid folder'%tn_path)
                raise FatalError()
        for i, fullpath in enumerate(self.filenames):
            print('\r' + progress_maker(i, len(self.filenames)), end='')
            name = os.path.basename(fullpath)
            t_tn_path = os.path.join( tn_path, name )
            if self.overwrite or not os.path.exists(t_tn_path):
                rot = img_mgr.get_rotation( fullpath )
                src_img = img_mgr.minify( fullpath )
                src_img = img_mgr.rotate( src_img, rot)
                img_mgr.save(src_img, t_tn_path, quality=60 )
        print('\r' + progress_maker(len(self.filenames), len(self.filenames)), end='')

class Output:
    path = None
    def __init__(self, path):
        self.path = path
    def open_file(self, name, mode='w'):
        return open(os.path.join(self.path, name), mode)

class Writer:
    def __init__(self, images, out):
        self.out = out
        self.images = images

class JSONWriter(Writer):
    def write(self, index='images.js'):
        import json
        c = list(self.images.infos[0].keys())
        r = [list(i.values()) for i in self.images.infos]
        json.dump({'c': c, 'r': r, 'version': 1}, self.out.open_file(index))

class HTMLWriter(Writer):

    def write(self, index='index.html'):
        tn_path = os.path.join(self.out.path, 'tn')
        fd = open(os.path.join(self.out.path, index), 'w')

        fd.write("""<!DOCTYPE HTML>
            <html>
            <head>
            <title>Gallery</title>
            </head>
            <body>
            <a href="package.zip">Download all files</a><br/>
            <div id="container">""")

        for i in self.images.infos:
            fd.write('<a href="%(f)s"><img src="%(t)s" /></a>\n'%i)

        fd.write("</div></body></html>")

INDEX = """
<!DOCTYPE HTML>
<html>
    <head>
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">

        <meta charset="utf-8"> 
        <title>Gallery</title>
        <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>
        <style>
body{background:#333;margin:0;padding:0;font-family:'PT Sans',sans-serif}#global_container{padding:1ex}img{border:none;margin:1ex;border:solid 3px #555;border-radius:3px}img.tn:hover{border:solid 3px #EEE;transform:scale(1.2);z-index:3;transition-duration:300ms}a{font-weight:bold}h1{margin:0;color:#DDE}button{font:bold 20px/1 "helvetica neue",helvetica,arial,sans-serif;margin:2px 1ex;text-align:center;text-shadow:0 1px 0 #fff;cursor:pointer;color:white;background:#555;border:solid 3px white;border-radius:3px;margin-right:1ex;padding:5px}button:hover{border-color:#EA3;transition-duration:300ms;transform:scale(1.25)}button.current{color:#EA3}hr{margin:.5ex auto 0 auto;width:50%}input#delay{border-radius:3px;float:left;font-size:150%;background-color:white;padding:0.4ex 0px 0px;text-align:center;border:medium none}button.busy{color:orange}#projector{position:fixed;top:0;left:0;width:98%;height:98%;background-color:rgb(28,35,42);margin:0;padding:1%;z-index:3;transition-property:top;transition-duration:230ms;transition-timing-function:ease-in}#projected{display:block;margin:auto auto 0 auto;min-width:10px;min-height:10px;max-width:90%;max-height:90%;transition-property:opacity,transform;transition-duration:1000ms}#popup{position:fixed;left:50%;top:50%;text-align:center;background:rgba(255,255,255,0.8);padding:1ex;border:3px solid #AAA;color:black;font-weight:bold;transition-property:top;transition-duration:230ms;transition-timing-function:ease-in;z-index:42;margin-left:-40ex;width:80ex}#popup h1{color:#333}.cache{display:block;width:1px;height:1px;opacity:0.1;margin-top:1ex;border:none}.slide-down{top:101%!important}.pull-right{float:right}.bg_caption{color:#EEE;text-decoration:none}.bigfont{font-size:200%;font-weight:bold}.loading{opacity:0.0}.icon_cycle,.icon_hdd,.icon_pack,.icon_cross,.icon_right,.icon_left,.icon_play,.icon_stop{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSI2NHB4IgogICB2aWV3Qm94PSIwIDAgNjQgNTEyIgogICBoZWlnaHQ9IjUxMnB4IgogICBpZD0ic3ZnMiIKICAgdmVyc2lvbj0iMS4xIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29ucy5zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMxOSIgLz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MTgiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1OSIKICAgICBpZD0ibmFtZWR2aWV3MTciCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6em9vbT0iMy40NzY2MDgzIgogICAgIGlua3NjYXBlOmN4PSItMi42NTEzMjUzIgogICAgIGlua3NjYXBlOmN5PSI4Ni43MTUxODIiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMiI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgaWQ9ImdyaWQzNzc0IiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogICAgICAgIAo8c3ZnCnk9IjAiCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIAogICB2ZXJzaW9uPSIxLjEiCiAgIHdpZHRoPSI2NCIKICAgaGVpZ2h0PSI2NCIKICAgaWQ9InN2ZzM4MDkiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuNDguNSByMTAwNDAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Imljb25fY3ljbGUuc3ZnIj4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjN2Y3ZjdmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuNjYyNzQ1MSIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iODA4IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjM2NCIKICAgICBpZD0ibmFtZWR2aWV3NyIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iMy42ODc1IgogICAgIGlua3NjYXBlOmN4PSIzMiIKICAgICBpbmtzY2FwZTpjeT0iMzIiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjExMTAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjM2NiIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9InN2ZzM4MDkiIC8+CiAgPGRlZnMKICAgICBpZD0iZGVmczM4MTEiIC8+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhMzgxNCI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGUgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpZD0ibGF5ZXIxIgogICAgIHN0eWxlPSJmaWxsOiNmZmZmZmYiPgogICAgPHBhdGgKICAgICAgIGQ9Im0gMzYuMDk2MjcxLDEuODc1ODg4MyBjIC04LjQzMTY1MywwIC04Ljg1MTUzNSwwLjA4NzgzIC03LjU2NTY1MiwxLjU2MzM4NiAwLjc0OTM0MSwwLjg1OTg2MSAyLjk4MDQ5Myw0LjU0MDc2NyA0Ljk2OTMxOSw4LjE3OTgzMDcgbCAzLjYyOTI3OSw2LjYxNjQ2NSAtMS45MjYzMDcsMS42NDcxMzUgYyAtMS45MDQzNjQsMS42MTQ4MDggLTEuODExMjk4LDEuNjM4NTQxIDUuNjExNDIyLDEuNDIzNzkxIGwgNy41Mzc3MzksLTAuMjIzMzM2IDMuMzc4MDIsLTUuODA2ODUzIGMgMy45NzQ1NTEsLTYuODMyNzA0NyA0LjE3OTUyNCwtNy44NzA0Nzc3IDEuMjAwNDU1LC01LjkxODUxNjcgLTIuMTUzNjYzLDEuNDExMTI3NyAtMi4yNDg3MDgsMS4zODM5MDc3IC0zLjY4NTExNSwtMS40NTE3MTMgLTIuOTU1OTczLC01LjgzNTM5NSAtMy4zOTA1OTksLTYuMDMwMTg5IC0xMy4xNDkxNiwtNi4wMzAxODkgeiBtIC0xMy44MTkxODYsMC44OTMzNjEgYyAtMy4yOTc0NDksMC4xOTQ5MjUgLTQuOTE3ODQyLDIuMDI0NTQ3IC05LjQ2NDA0Niw5LjkzODY0NzcgbCAtMi4zNzI5ODcsNC4xMDM4NzMgNi4wNTgxMDIsMy42NTcyMDIgYyAzLjMyNTk4LDIuMDA3OTI5IDYuMzM3OTU4LDMuNTYzNDc4IDYuNzAwMjE0LDMuNDYxNzcgMC4zNjIyNTYsLTAuMTAxNjkgMi40MTU0MywtMy4xODI1OTkgNC41Nzg0NzYsLTYuODY3NzE0IDMuNjY3MDcxLC02LjI0NzQ2IDMuODQ2MDUzLC02Ljg2MTM3NyAyLjcwODAwNSwtOS4wNzMyMDA3IC0yLjAzMTk0NCwtMy45NDkwODQgLTMuODQzNjE2LC01LjIyMDU3OCAtNy41MDk4MjYsLTUuMjIwNTc4IC0wLjIzNjA1NSwwIC0wLjQ3ODEwOCwtMC4wMTI5MyAtMC42OTc5MzgsMCB6IE0gNTUuOTQ1NjQ1LDIwLjYzNjQ4IGMgLTEuMTYyMTM3LDAgLTEyLjQxNTI2Niw2LjcwMDE1OCAtMTIuNDIzMzA4LDcuMzk4MTQ0IC0wLjAwNDcsMC4zODQzNjcgMS43MDg1NTgsMy42Njc5MTUgMy43OTY3ODcsNy4zMTQzOTMgMy43NDc3LDYuNTQ0MjcyIDMuODQ4NzUzLDYuNjU2NTQ1IDcuODE2OTEsNi45NzkzODYgMi4yMTEwNjYsMC4xNzk4OTEgMC4xMDA1LDAuMzg2MDczIC00LjY5MDE0OCwwLjQ3NDYwMyBsIC04LjcxMDI3LDAuMTY3NSAwLC0yLjIzMzQwMiBjIDAsLTMuNDgwMTUxIC0xLjA0OTAyMiwtMi42NzI4MDggLTQuNzE4MDYyLDMuNjAxMzY1IGwgLTMuNDA1OTQzLDUuODA2ODQ0IDMuNDA1OTQzLDYuMjI1NjEyIGMgMy42MDc4Nyw2LjYyNDgwNiA0LjcxODA2Miw3LjU4MjAzNiA0LjcxODA2Miw0LjA0ODA0NSAwLC0yLjAzNzY5OCAwLjM1OTgxOCwtMi4yMDczMTYgNS4xMzY4MjgsLTIuNDU2NzM3IGwgNS4xMzY4MjgsLTAuMjUxMjU4IDQuMjQzNDY4LC03LjQ1Mzk4OSBjIDIuMzQyNjU2LC00LjA5MTMyMiA0LjA2NDQ3NywtNy43MzYwMjkgMy44MjQ3MDEsLTguMTI0MDA1IC0wLjIzOTc4NiwtMC4zODc5ODUgMC4zNjg5MjksLTEuNDM4MzEgMS4zNDAwNDEsLTIuMzE3MTUxIDIuNzc1MjI5LC0yLjUxMTU0MiAyLjI3MTA5MSwtNy4wMDQ4NzIgLTEuNTM1NDYzLC0xMy41MTIwOTIgLTEuODIxODA1LC0zLjExNDMzMyAtMy41OTg3MDQsLTUuNjY3MjU4IC0zLjkzNjM3NCwtNS42NjcyNTggeiBtIC00MC4yNTcwOTMsMi42ODAwODIgLTcuNzYxMDgzMiwwLjAyNzg0IGMgLTcuMDAwNTUwNzYsMC4wMjU2OCAtNy41NzA3MjMxMiwwLjE1MzcyIC02LjAwMjI2NjIsMS4zNDAwNSAwLjk1Mzc3MSwwLjcyMTM5IDIuMDk0NDM0NCwxLjMxMjExOCAyLjUxMjU3MzMsMS4zMTIxMTggMC40MTgxNTc3LDAgLTAuMjU4NDU2OSwxLjc0OTE0NCAtMS41MDc1NDAyLDMuODgwNTM3IC0xLjI0OTA4MzMsMi4xMzE0MDIgLTIuMjg5MjM4MDYsNC40MDEzNiAtMi4yODkyMzgwNiw1LjA1MzA3OSAwLDAuNjUxNzE5IDEuOTE1MDY4ODYsNC41NjIxMjkgNC4yNDM0NTg1Niw4LjcxMDI3MSAzLjA5NzM4NjYsNS41MTgxNzcgNC4zNTU5OTMxLDcuMTA0MTM0IDQuNjkwMTQ4Miw1Ljg5MDYwMyAwLjI1MTE5MjYsLTAuOTEyMjQ4IDIuMTc3MTQzNiwtNC43NjM2MDYgNC4yOTkzMDM2LC04LjU3MDY4NSAzLjQ5NTY0NSwtNi4yNzEwNDMgNC4wMzUxMzksLTYuODQ3ODQyIDUuNjY3MjU5LC01Ljk3NDM1MyAyLjk4ODcyMywxLjU5OTUxIDIuODU3NTI2LDAuMzUxMjMzIC0wLjU4NjI2NywtNS44MDY4NTQgbCAtMy4yNjYzNDgsLTUuODYyNjggeiBtIDE1LjQxMDQ3NiwxOS41NzAxOTQgLTguNzY2MTA3LDAuMjc5MTcyIC04LjczODE4NCwwLjI1MTI1OCAtMS43MDI5NzIsMy4xODI2MDggYyAtMS45OTQyMjU0LDMuNzI0NTc2IC0xLjQ4OTkzNyw3LjAwNDU2MiAxLjQ3OTYyNyw5Ljc3MTEzMSAxLjczMTkwNywxLjYxMzQ3NiAyLjkxMDUyMiwxLjgxNDY3MiA5LjU3NTcxOCwxLjU5MTMwOCBsIDcuNjIxNDg4LC0wLjI1MTI1OCAwLjI1MTI1OCwtNy4zOTgxNTMgMC4yNzkxNzIsLTcuNDI2MDY2IHoiCiAgICAgICBpZD0icGF0aDI5OTgiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmIiAvPgogIDwvZz4KPC9zdmc+Cgo8c3ZnCnk9IjY0IgogICAKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgdmVyc2lvbj0iMS4xIgogICB3aWR0aD0iNjQiCiAgIGhlaWdodD0iNjQiCiAgIGlkPSJzdmczODA5IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29uX2hkZC5zdmciPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiMxZTFlMWUiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4zNDkwMTk2MSIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTkyMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDgwIgogICAgIGlkPSJuYW1lZHZpZXcyOTg5IgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIzLjY4NzUiCiAgICAgaW5rc2NhcGU6Y3g9Ii0yLjYxMjQyNDgiCiAgICAgaW5rc2NhcGU6Y3k9IjQzLjIwMjM1MyIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMCIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9InN2ZzM4MDkiIC8+CiAgPGRlZnMKICAgICBpZD0iZGVmczM4MTEiIC8+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhMzgxNCI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGUgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPHBhdGgKICAgICBzdHlsZT0iZmlsbDojZmZmZmZmIgogICAgIGQ9Ik0gMzEuNjg3NSwxLjUzMTI1IEMgMzEuMzEyMDQsMS41NzQzNDc3IDMwLjk2NDc1NSwxLjcxNTM3ODQgMzAuNjU2MjUsMiAzMC4yNTU3NzksMi4zMTY0NDc4IDI5LjkyOTQ5LDIuNzEwMTcwOSAyOS41NjI1LDMuMDYyNSBjIC04LjZlLTQsMC4wODk3OTggOC42ZS00LDAuMTkxNDUyMSAwLDAuMjgxMjUgLTAuMDEwOSwyLjM3OWUtNCAtMC4wMjAzNiwtMi40MTJlLTQgLTAuMDMxMjUsMCBsIDAsNC42ODc1IGMgMC4wMTAzOSwtMi42M2UtNSAwLjAyMDkyLDcuMTdlLTUgMC4wMzEyNSwwIDAuMDAxMywxLjM3Njc5MjMgMC4yMTYzMywyLjYwOTYzOCAtMC4wNjI1LDMuODQzNzUgLTAuNTA2MTA3LDIuMjQwMDUgLTcuMzE3OTk4LDAuNTkwNTQyIC0xMC4wOTM3NSwxLjY1NjI1IC0wLjk5NDY5NiwwLjU4MTU1OSAtMC4wNDMsMS43ODg3MTQgMC40Njg3NSwyLjM3NSAzLjY3MzUxOSwzLjU4MDggNy4yMzIyNSw3LjI5MjMzOCAxMC45Mzc1LDEwLjg0Mzc1IDEuMTU0MzI5LDAuODM0MTc1IDIuNjYzNTI4LDAuMDk3ODQgMy40Njg3NSwtMC44NzUgMS45NzM2ODMsLTIuMTIxNTI3IDQuMDkzODM4LC00LjExNzk0MiA2LjEyNSwtNi4xODc1IDEuMzg0OTk2LC0xLjQxNjAwOSAyLjgyODQ1MSwtMi43ODI4MzQgNC4xNTYyNSwtNC4yNSAwLjYwMzgwMSwtMC43NDI5ODcgMC4yNzUwOTUsLTIuMDY3MzY5IC0wLjc1LC0yLjE4NzUgLTIuNjkyNjIzLDAuMjMzMDMgLTUuMzkwNDc2LDAuMTA5ODUzIC03LjkwNjI1LC0wLjA2MjUgLTEuMTAwNzkzLC0wLjI2NDU1NCAtMS42NjIxNzYsLTEuMzg5NTcyIC0xLjY4NzUsLTIuNDY4NzUgbCAtMC4wNjI1LDAgMCwtOC4wMzEyNSBDIDMzLjY2OTM3NCwyLjA1MjY2NDEgMzIuODY0MTIxLDEuNTc2MDc5MyAzMi4wNjI1LDEuNTMxMjUgYyAtMC4xMjY3OTcsLTAuMDA3MDkgLTAuMjQ5ODQ3LC0wLjAxNDM2NiAtMC4zNzUsMCB6IG0gLTYuMjUsMiBDIDE3LjU2ODIzOCw0LjA5NTQ1NDEgMTIuMTY3MTk0LDUuODMxODk1NyA2LjcxODc1LDkuNDM3NSBjIC01LjYxMDgxODQsMy43MTMwNjggLTUuOTM3NSw0Ljg5MjkzNiAtNS45Mzc1LDI0IDAsMTYuNzM1OTU2IDAuMDM4OTAwNSwxNi45NzQwNzMgMi4xNTYyNSwxOS43NSAyLjU0MjMwMTMsMy4zMzMxMzcgOS43NzQwODcsNi45NzA0NTkgMTcuMDkzNzUsOC41NjI1IDE0LjA5MzcxNSwzLjA2NTM4OSAzMS42MzY1ODMsMC4wMTQ4OSAzOS4wOTM3NSwtNi43ODEyNSA0LjA3NTMwMywtMy43MTQwNTEgNC40Mzc1LC01LjUwODk5NSA0LjQzNzUsLTIyLjA2MjUgMCwtMTcuNjc4MTI1IC0wLjMzMTczMiwtMTkuMDA4MTA4IC02LjE4NzUsLTIzLjI1IEMgNTIuNTAyMyw2LjEyNjQ3NzMgNDYuNDQyNTgxLDQuMTk1MjIxNSAzOC4yNSwzLjU2MjUgYyAwLDAgLTAuNTc1MzMyLDIuMzk4MjEwMSAwLDQuODEyNSAwLjkxNDMxNSwwLjE3NzAwMTggMS43MTE1MjcsLTAuNjY3NzMyOCAxMC42MjUsMi4wMzEyNSA4LjczMTQ0MiwyLjY0Mzg2NCAxMS42NTY5NDYsOC4zNDMwNTUgNy43MTg3NSwxMi4yODEyNSAtMi43MjE0MTUsMi43MjE0MDYgLTkuOTc5MjgsNS43MTA2ODggLTE2LjI1LDYuNzE4NzUgLTguNzg0MjIsMS40MTIxNDMgLTE1LjY3MTA3NCwwLjg4MzQ0MSAtMjMuOTM3NSwtMS44MTI1IEMgMTAuNjE3NzQ1LDI1LjcwNTk0MyA1LjA5Mzc1LDIxLjY0MDc2MSA1LjA5Mzc1LDE5LjI1IGMgMCwtMy45ODUxMjYgNi42NzIzMzgsLTguNDUzODI2IDE1LjU5Mzc1LC0xMC40Mzc1IDEuMzMxMTM5LC0wLjI5NTk3NTggMi45NjI2MjEsLTAuNDkwOTU3IDQuNzUsLTAuNjI1IHogTSA1LjA5Mzc1LDI3LjgxMjUgOS4yNSwyOS45MDYyNSBjIDEyLjEwNzIyNCw2LjA4MTExNCAzMy4zNTU3MTUsNi4yNjcwMSA0NC44NDM3NSwwLjQwNjI1IDEuODU3OTk0LC0wLjk0Nzg2OCAzLjU4ODQ1LC0xLjcxODc1IDMuODQzNzUsLTEuNzE4NzUgMC4yNTUzLDAgMC40Njg3NSwxLjU1NjU3NCAwLjQ2ODc1LDMuNDA2MjUgMCw0LjEzODI4NSAtMi43NDUzNyw2Ljc0NjYyNyAtMTAuMDYyNSw5LjU2MjUgLTYuMTY3MzQ4LDIuMzczMzk2IC0yMS41MDAyNzksMy4xMzE2NzQgLTI4LjE4NzUsMS4zNzUgQyA5LjQ3MzIzOTIsNDAuMTMxMTU1IDUuMDkzNzUsMzYuNzE0NTMzIDUuMDkzNzUsMzEuMjUgeiBtIDUzLjMxMjUsMTQuNTMxMjUgMCwzLjQ2ODc1IGMgMCwyLjY3MjY1MSAtMC41MzQzNCw0LjAwMzczMiAtMi4yNSw1LjU5Mzc1IEMgNTMuNTI4MzE5LDUzLjg0MTczIDQ2LjIwMDEyMSw1Ni43NjI3MyA0MSw1Ny40Mzc1IDMzLjgwMTI4LDU4LjM3MTYxNiAzMS4yMjA0MzUsNTguNDM1MTU4IDI1LjE4NzUsNTcuODEyNSAxOC4xMTY4MTMsNTcuMDgyNzE3IDkuMjUzMjgxOSw1My40NjM2NTkgNi43NSw1MC4yODEyNSA0Ljg1NTczNjksNDcuODczMDg4IDQuMzg5OTcyNiw0MS44Nzg0MyA2LjE1NjI1LDQyLjY1NjI1IGMgMTMuMDE1ODE4LDUuNzMxODY2IDIxLjgwMzIwNSw3LjI1MjQ4OSAzMy4wOTM3NSw1Ljc1IDcuMjI5NDU5LC0wLjk2MjA2NyAxMS43NTU1OCwtMi4yMzQwNyAxNi41LC00LjY4NzUgeiIKICAgICBpZD0icGF0aDMwMDAiCiAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICBzb2RpcG9kaTpub2RldHlwZXM9InNjY2NjY2NzY2NjY2NjY2NjY2Njc2Nzc3Nzc3NzY2Nzc3Nzc3NjY2Njc3Nzc3NzY2Nzc3Nzc3NzY2MiIC8+Cjwvc3ZnPgoKPHN2Zwp5PSIxMjgiCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIAogICB2ZXJzaW9uPSIxLjEiCiAgIHdpZHRoPSI2NCIKICAgaGVpZ2h0PSI2NCIKICAgaWQ9InN2ZzM4MDkiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuNDguNSByMTAwNDAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Imljb25fcGFjay5zdmciPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiM2MzYzNjMiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC42Nzg0MzEzNyIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTEwOCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDU5IgogICAgIGlkPSJuYW1lZHZpZXcyOTk4IgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSI1LjIxNDkxMjUiCiAgICAgaW5rc2NhcGU6Y3g9IjE1LjM4MTQ1NiIKICAgICBpbmtzY2FwZTpjeT0iMzkuNjI4MjQ0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIxOSIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9InN2ZzM4MDkiIC8+CiAgPGRlZnMKICAgICBpZD0iZGVmczM4MTEiIC8+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhMzgxNCI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGUgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpZD0ibGF5ZXIxIgogICAgIHN0eWxlPSJzdHJva2U6bm9uZTtmaWxsOiNmZmZmZmYiPgogICAgPGcKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuOTA0NTQyODgsMCwwLDAuOTA0NTQyODgsLTI1MC44MTkxNywtMjU1LjM0NjQ2KSIKICAgICAgIGlkPSJnMzg5MSIKICAgICAgIHN0eWxlPSJzdHJva2U6bm9uZTtmaWxsOiNmZmZmZmYiPgogICAgICA8cGF0aAogICAgICAgICBkPSJtIDI5Ny44NTgwMywyODMuNjM2MDkgYyAtMy4xMDQxNCwwIC01LjU4MzY4LDIuNTA2NzcgLTUuNTgzNjgsNS42MTA5MSBsIDAsNTEuNjY5NDIgYyAwLDMuMTA0MTMgMi40Nzk1NCw1LjYxMDkxIDUuNTgzNjgsNS42MTA5MSBsIDMzLjkzNzg1LDAgYyAzLjEwNDEzLDAgNS42MTA5MSwtMi41MDY3OCA1LjYxMDkxLC01LjYxMDkxIGwgMCwtMzAuNDc4NyAtMC4xMDg5NSwtMC4xMDg5NCBjIC0wLjA3MDUsLTAuMjYyNzMgLTAuMTk4NjYsLTAuNTI2OTYgLTAuNDA4NTYsLTAuNzM1NDIgTCAzMTEuMjU4ODUsMjg0LjE1MzYgYyAtMC4xMDY1NiwtMC4xMDU4MyAtMC4yMjk5MiwtMC4xNzUxIC0wLjM1NDA5LC0wLjI0NTE0IC0wLjA4NTgsLTAuMDg3NCAtMC4xNzA1MywtMC4xNzc2OSAtMC4yNDUxNCwtMC4yNzIzNyBsIC0xMi44MDE1OSwwIHogbSAxMy40MDA4Miw0Ljc5Mzc4IDIxLjQ5MDM0LDIxLjM1NDE2IC0xNS44Nzk0MywwIGMgLTMuMTA0MTQsMCAtNS42MTA5MSwtMi40Nzk1NCAtNS42MTA5MSwtNS41ODM2OCBsIDAsLTE1Ljc3MDQ4IHoiCiAgICAgICAgIGlkPSJwYXRoMzgwMiIKICAgICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS43NDMxOTYwMDk5OTk5OTk5MTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2Utb3BhY2l0eToxO3N0cm9rZS1kYXNoYXJyYXk6bm9uZSIgLz4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICAgICAgZD0ibSAyOTMuMzA2NDcsMjg3Ljk2NzUzIGMgLTQuNjQyNzMsLTAuMTM3NzcgLTYuMzYxNDEsNS4xMjUxMSAtNS41ODE0OCw4Ljk0NTIgMC4wNjAyLDE2LjQ5NzI1IC0wLjEzNTA0LDMzLjAwNzI0IDAuMTAxMjcsNDkuNDk2NSAwLjcwNDMxLDMuOTMwMTggNS4xMTQzNiw0Ljk2NDE3IDguNTA4MDcsNC40NDY3OSAxMC42OTM4LC0wLjA1OTQgMjEuNDAxMTgsMC4xMzc5MSAzMi4wODY0MiwtMC4xMDQ0OCAzLjUzNDE2LC0wLjY0OTI4IDQuOTMzMTEsLTQuNTU1NTEgNC40MzQ0OCwtNy43NTA0MyAwLC05LjQxMDY1IDAsLTE4LjgyMTI5IDAsLTI4LjIzMTkzIC0xLjMyMTY5LC0xLjc0NjYyIC00LjE3NDU3LC0xLjA4MTA4IC02LjE4ODE1LC0xLjY5MTY4IC01LjIwNDY0LC0wLjc3NzY5IC0xMC40MDkyNywtMS41NTUzOCAtMTUuNjEzOTEsLTIuMzMzMDcgLTEuNjQyODQsLTcuNDg1NTQgLTMuMDMwMTEsLTE1LjAyNDc0IC00LjY5OTk2LC0yMi41MDQ1MiAtMy4zMjY5NCwtMC41MzIxIC02LjgzMTkxLC0wLjE2MDQ2IC0xMC4yNDI2OSwtMC4yNzIzNyAtMC45MzQ2OCwtMTBlLTYgLTEuODY5MzksMWUtNSAtMi44MDQwNSwtMTBlLTYgeiBtIDkuNjkwOTIsMTMuNDg1NTUgYyA0LjQ0Mjg2LDUuMjQ1NDMgOC44ODU3MSwxMC40OTA4NyAxMy4zMjg1NywxNS43MzYzIC0yLjc4MTUzLC0yLjY1MzYxIC02LjYzNjE2LC00LjE0MDI5IC05LjE0NDM0LC02LjkzMDMgLTAuOTEzNzksLTMuMTM1NDQgLTIuNzU2MywtNS44ODQ3NiAtNC4xODQyMywtOC44MDYgeiIKICAgICAgICAgaWQ9InJlY3QzMDE5IgogICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cgo8c3ZnCnk9IjE5MiIKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIHZlcnNpb249IjEuMSIKICAgd2lkdGg9IjY0IgogICBoZWlnaHQ9IjY0IgogICBpZD0ic3ZnMzgwOSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC41IHIxMDA0MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iaWNvbl9wYWNrLnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzYzNjM2MyIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY3ODQzMTM3IgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSI5NTgiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1OSIKICAgICBpZD0ibmFtZWR2aWV3Mjk5OCIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iNS4yMTQ5MTI1IgogICAgIGlua3NjYXBlOmN4PSIxNS43NjQ5NzIiCiAgICAgaW5rc2NhcGU6Y3k9IjM5LjYyODI0NCIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMCIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMTkiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmczODA5IiAvPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMzODExIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTM4MTQiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaWQ9ImcyOTg5IgogICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuODQ4NjM0OTQsLTAuNzI2Nzk1NjEsMC43NzIxMTg2NiwwLjc5ODgyMDQyLC0xNS4yNTM1ODEsMjcuMTM1ODA3KSI+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICAgIGQ9Im0gMjcuNjEzMTE5LDMuOTc5ODE3NiBjIDMuMTg3MDE0LDAgNS43NTI3MzMsMi41NjU3MTkgNS43NTI3MzMsNS43NTI3MzMzIGwgMCw0Ni4wMjE4NjYxIGMgMCwzLjE4NzAxNCAtMi41NjU3MTksNS43NTI3MzMgLTUuNzUyNzMzLDUuNzUyNzMzIC0zLjE4NzAxNCwwIC01Ljc1MjczMywtMi41NjU3MTkgLTUuNzUyNzMzLC01Ljc1MjczMyBsIDAsLTQ2LjAyMTg2NjEgYyAwLC0zLjE4NzAxNDMgMi41NjU3MTksLTUuNzUyNzMzMyA1Ljc1MjczMywtNS43NTI3MzMzIHoiCiAgICAgICBpZD0icmVjdDI5ODUiIC8+CiAgICA8cGF0aAogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMCwtMSwxLDAsMCwwKSIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICBkPSJtIC0zMi43NDM0ODMsLTEuMTUwNTQ3NSBjIDMuMTg3MDE1LDAgNS43NTI3MzQsMi41NjU3MTkgNS43NTI3MzQsNS43NTI3MzMyIGwgMCw0Ni4wMjE4NjYzIGMgMCwzLjE4NzAxNCAtMi41NjU3MTksNS43NTI3MzMgLTUuNzUyNzM0LDUuNzUyNzMzIC0zLjE4NzAxNCwwIC01Ljc1MjczMywtMi41NjU3MTkgLTUuNzUyNzMzLC01Ljc1MjczMyBsIDAsLTQ2LjAyMTg2NjMgYyAwLC0zLjE4NzAxNDIgMi41NjU3MTksLTUuNzUyNzMzMiA1Ljc1MjczMywtNS43NTI3MzMyIHoiCiAgICAgICBpZD0icmVjdDI5ODciIC8+CiAgPC9nPgo8L3N2Zz4KCjxzdmcKeT0iMjU2IgogICAKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgdmVyc2lvbj0iMS4xIgogICB3aWR0aD0iNjQiCiAgIGhlaWdodD0iNjQiCiAgIGlkPSJzdmczODA5IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29uX2Nyb3NzLnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzYzNjM2MyIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY3ODQzMTM3IgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSI5NTgiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1OSIKICAgICBpZD0ibmFtZWR2aWV3Mjk5OCIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iNS4yMTQ5MTI1IgogICAgIGlua3NjYXBlOmN4PSIxNS41MzY2NjYiCiAgICAgaW5rc2NhcGU6Y3k9IjI2LjAzNzczNSIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMCIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMTkiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmczODA5IiAvPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMzODExIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTM4MTQiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaWQ9ImczMDI0IgogICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMjkzNzc5NywwLDAsMS4yOTM3Nzk3LC03LjMzODkxMzcsLTkuNTE0ODg1NykiPgogICAgPHBhdGgKICAgICAgIGlkPSJyZWN0Mjk4NSIKICAgICAgIGQ9Im0gMTUuMzc1LDguNjI1IGMgLTEuNDc1ODk0LDAuMDY3NjU5IC0yLjk0MTczMywwLjYxMTYxNTMgLTQuMTI1LDEuNjI1IC0yLjcwNDYxMTQsMi4zMTYzMDggLTIuODk4MjUzNyw2LjIzNTM5OCAtMC40Mzc1LDguNzgxMjUgbCAyMiwyMi43NSA5LjgxMjUsLTguMzEyNSAtMjIuMDYyNSwtMjIuODEyNSBDIDE5LjE3ODMyNiw5LjIyNDIwOCAxNy4yNzI1NzgsOC41MzgwMTA0IDE1LjM3NSw4LjYyNSB6IgogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICA8cGF0aAogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY3NjY2NjIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJyZWN0Mjk4NyIKICAgICAgIGQ9Ik0gMzMuNzgxMjUsMjQuNTYyNSA5LjUsNDUuMzQzNzUgYyAtMi43MDQ2MTE2LDIuMzE2MzA4IC0yLjg5ODI1MzcsNi4yMzUzOTcgLTAuNDM3NSw4Ljc4MTI1IDIuNDYwNzUzLDIuNTQ1ODUyIDYuNjA3ODg5LDIuNzIyNTU4IDkuMzEyNSwwLjQwNjI1IEwgNDIuNDcxOTI4LDMzLjUwMTU4OSBDIDQyLjMxOTk5NCwzMy4zNDI4IDQxLjczODc0OSwzMy45NTIzNzUgNDEuNTkzNzUsMzMuNzgxMjUgeiIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiIC8+CiAgPC9nPgo8L3N2Zz4KCjxzdmcKeT0iMzIwIgogICAKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgdmVyc2lvbj0iMS4xIgogICB3aWR0aD0iNjQiCiAgIGhlaWdodD0iNjQiCiAgIGlkPSJzdmczODA5IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29uX3JpZ2h0LnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzYzNjM2MyIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY3ODQzMTM3IgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSI5NTgiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1OSIKICAgICBpZD0ibmFtZWR2aWV3Mjk5OCIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iNS4yMTQ5MTI1IgogICAgIGlua3NjYXBlOmN4PSIxNS41MzY2NjYiCiAgICAgaW5rc2NhcGU6Y3k9IjI2LjAzNzczNSIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMCIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMTkiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmczODA5IiAvPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMzODExIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTM4MTQiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaWQ9ImczMDI0IgogICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLjMzMDg4MTMsMCwwLDEuMzMwODgxMyw3Mi41MTM3MTIsLTEwLjcxNjUyNCkiPgogICAgPHBhdGgKICAgICAgIGlkPSJyZWN0Mjk4NSIKICAgICAgIGQ9Im0gMTUuMzc1LDguNjI1IGMgLTEuNDc1ODk0LDAuMDY3NjU5IC0yLjk0MTczMywwLjYxMTYxNTMgLTQuMTI1LDEuNjI1IC0yLjcwNDYxMTQsMi4zMTYzMDggLTIuODk4MjUzNyw2LjIzNTM5OCAtMC40Mzc1LDguNzgxMjUgbCAyMiwyMi43NSA5LjgxMjUsLTguMzEyNSAtMjIuMDYyNSwtMjIuODEyNSBDIDE5LjE3ODMyNiw5LjIyNDIwOCAxNy4yNzI1NzgsOC41MzgwMTA0IDE1LjM3NSw4LjYyNSB6IgogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICA8cGF0aAogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY3NjY2NjIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJyZWN0Mjk4NyIKICAgICAgIGQ9Ik0gMzMuNzgxMjUsMjQuNTYyNSA5LjUsNDUuMzQzNzUgYyAtMi43MDQ2MTE2LDIuMzE2MzA4IC0yLjg5ODI1MzcsNi4yMzUzOTcgLTAuNDM3NSw4Ljc4MTI1IDIuNDYwNzUzLDIuNTQ1ODUyIDYuNjA3ODg5LDIuNzIyNTU4IDkuMzEyNSwwLjQwNjI1IEwgNDIuNDcxOTI4LDMzLjUwMTU4OSBDIDQyLjMxOTk5NCwzMy4zNDI4IDQxLjczODc0OSwzMy45NTIzNzUgNDEuNTkzNzUsMzMuNzgxMjUgeiIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiIC8+CiAgPC9nPgo8L3N2Zz4KCjxzdmcKeT0iMzg0IgogICAKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgdmVyc2lvbj0iMS4xIgogICB3aWR0aD0iNjQiCiAgIGhlaWdodD0iNjQiCiAgIGlkPSJzdmczODA5IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29uX2xlZnQuc3ZnIj4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjNjM2MzYzIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuNjc4NDMxMzciCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9Ijk1OCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDU5IgogICAgIGlkPSJuYW1lZHZpZXcyOTk4IgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIzLjY4NzUiCiAgICAgaW5rc2NhcGU6Y3g9IjQ0LjA3NjY3OSIKICAgICBpbmtzY2FwZTpjeT0iNzAuNTA2MjUiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8cGF0aAogICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgZD0iTSAyNi41NjI1IDEuNjU2MjUgQyAyNS4xMDgxNTcgMS43MjI5MjEyIDIzLjYyOTEzMyAyLjEzMDk1MiAyMi4zNDM3NSAyLjkwNjI1IEMgMjIuOTU4OTY2IDMuMjc5NDg2NCAyMy41NDQ0ODUgMy43NDUzMjA5IDI0LjA2MjUgNC4yODEyNSBMIDUyLjU5Mzc1IDMzLjc4MTI1IEwgNDguNDY4NzUgMzcuMjgxMjUgTCAyMS4yMTg3NSA2MS4wMzEyNSBDIDIwLjg1Nzk3MyA2MS4zNDAyMyAyMC40NTgxOTMgNjEuNjAzMjc3IDIwLjA2MjUgNjEuODQzNzUgQyAyMy4yMzI4ODMgNjMuNzg3NzQzIDI3LjQ5NjY1MyA2My41NDk4NzcgMzAuNDM3NSA2MS4wMzEyNSBMIDU3LjY4NzUgMzcuMjgxMjUgTCA2MS44MTI1IDMzLjc4MTI1IEwgMzMuMjgxMjUgNC4yODEyNSBDIDMxLjQ5MDQzIDIuNDI4NTAzMiAyOS4wMTc1NSAxLjU0MzcwNDYgMjYuNTYyNSAxLjY1NjI1IHogIgogICAgIGlkPSJwYXRoMzA2OCIgLz4KICA8ZwogICAgIGlkPSJnMzAyNCIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgxLjI5Mzc3OTcsMCwwLDEuMjkzNzc5NywtNy4zMzg5MTM3LC05LjUxNDg4NTcpIj4KICAgIDxwYXRoCiAgICAgICBpZD0icmVjdDI5ODUiCiAgICAgICBkPSJtIDE1LjM3NSw4LjYyNSBjIC0xLjQ3NTg5NCwwLjA2NzY1OSAtMi45NDE3MzMsMC42MTE2MTUzIC00LjEyNSwxLjYyNSAtMi43MDQ2MTE0LDIuMzE2MzA4IC0yLjg5ODI1MzcsNi4yMzUzOTggLTAuNDM3NSw4Ljc4MTI1IGwgMjIsMjIuNzUgOS44MTI1LC04LjMxMjUgLTIyLjA2MjUsLTIyLjgxMjUgQyAxOS4xNzgzMjYsOS4yMjQyMDggMTcuMjcyNTc4LDguNTM4MDEwNCAxNS4zNzUsOC42MjUgeiIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPHBhdGgKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjYyIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICBpZD0icmVjdDI5ODciCiAgICAgICBkPSJNIDMzLjc4MTI1LDI0LjU2MjUgOS41LDQ1LjM0Mzc1IGMgLTIuNzA0NjExNiwyLjMxNjMwOCAtMi44OTgyNTM3LDYuMjM1Mzk3IC0wLjQzNzUsOC43ODEyNSAyLjQ2MDc1MywyLjU0NTg1MiA2LjYwNzg4OSwyLjcyMjU1OCA5LjMxMjUsMC40MDYyNSBMIDQyLjQ3MTkyOCwzMy41MDE1ODkgQyA0Mi4zMTk5OTQsMzMuMzQyOCA0MS43Mzg3NDksMzMuOTUyMzc1IDQxLjU5Mzc1LDMzLjc4MTI1IHoiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIiAvPgogIDwvZz4KPC9zdmc+Cgo8c3ZnCnk9IjQ0OCIKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIHZlcnNpb249IjEuMSIKICAgd2lkdGg9IjY0IgogICBoZWlnaHQ9IjY0IgogICBpZD0ic3ZnMzgwOSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC41IHIxMDA0MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iaWNvbl9wbGF5LnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzYzNjM2MyIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY3ODQzMTM3IgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSI5NTgiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1OSIKICAgICBpZD0ibmFtZWR2aWV3Mjk5OCIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iMy42ODc1IgogICAgIGlua3NjYXBlOmN4PSI0NC4wNzY2NzkiCiAgICAgaW5rc2NhcGU6Y3k9IjcwLjUwNjI1IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIxOSIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9InN2ZzM4MDkiIC8+CiAgPGRlZnMKICAgICBpZD0iZGVmczM4MTEiIC8+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhMzgxNCI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGU+PC9kYzp0aXRsZT4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPHJlY3QKICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIgogICAgIGlkPSJyZWN0MzEwNCIKICAgICB3aWR0aD0iNTkuMTE4NjQ1IgogICAgIGhlaWdodD0iNTguMzA1MDg0IgogICAgIHg9IjIuNDQwNjc3OSIKICAgICB5PSIyLjQ0MDY3NzYiCiAgICAgcng9IjcuNzY4NjQ4MSIKICAgICByeT0iNS41ODU5NjgiIC8+Cjwvc3ZnPgoKPC9zdmc+);background-repeat:no-repeat;display:inline-block;width:64px;height:64px;z-index:1;margin-top:-16px;transform:scale(0.6)}.icon_cycle:hover,.icon_hdd:hover,.icon_pack:hover,.icon_cross:hover,.icon_right:hover,.icon_left:hover,.icon_play:hover,.icon_stop:hover{transform:scale(0.75);transition-duration:400ms}.icon_cycle{background-position:0 0px}.icon_hdd{background-position:0 -64px}.icon_pack{background-position:0 -128px}.icon_cross{background-position:0 -192px}.icon_right{background-position:0 -256px}.icon_left{background-position:0 -320px}.icon_play{background-position:0 -384px}.icon_stop{background-position:0 -448px}
        </style>
        <script src="//cdn.jsdelivr.net/isotope/2.0.0/isotope.pkgd.min.js"></script>
        <script type="text/javascript">
" use strict "
var data={};var pass='';var page_size=25;var cur_image=0;var isotope=0;var popup_delay=3000;var _popups=[];var _cur_popup=0;var expertise_level=0;function display_popup(content,opts){var opts=opts||{};var flush=!!opts.flush;if(_cur_popup!=0&&!flush){_popups.push([content,opts])}else{var o=document.querySelector('#popup');o.innerHTML=content;o.classList.remove("slide-down");if(!!!opts.stay){_cur_popup=setTimeout(remove_popup,popup_delay);}}}
function remove_popup(){var o=document.querySelector('#popup');_cur_popup=0;if(_popups.length!=0){var content=_popups.pop();display_popup(content[0],content[1]);}else{o.classList.add('slide-down');}}
var DC=function(query,klass){var q=document.querySelector(query);if(q)
q.classList.remove(klass);};var DCA=function(query,klass){var q=document.querySelectorAll(query);for(var i=0;i<q.length;i++){q[i].classList.remove(klass);}};var AC=function(query,klass){var q=document.querySelectorAll(query);for(var i=0;i<q.length;i++){q[i].classList.add(klass);}};var QSA=function(query){return document.querySelectorAll(query);};var QS=function(query){return document.querySelector(query);};var CE=function(tag){return document.createElement(tag);}
var switch_page=function(nr){isotope.arrange({filter:'.p'+nr});DCA('button','current');document.querySelectorAll('button')[nr].classList.add('current');}
var _set_left_image=function(url){setTimeout(function(){document.querySelector('#prev_projected').src=url;},550);}
var _set_right_image=function(url){setTimeout(function(){document.querySelector('#next_projected').src=url;},500);}
var _set_image=function(){_image_setter=0;document.querySelector('#projected').src=pass+'/'+data[cur_image].f;var txt=data[cur_image].f.replace(/.*[/]/,'');txt+=' ('+(1+cur_image)+'/'+data.length+')';document.querySelector('#projected_name').textContent=txt;}
var slideshow_id=false;var _start_show=function(){var slideshow_delay=Math.floor(parseFloat(document.querySelector('#delay').value)*1000);slideshow_id=setTimeout(next_image,slideshow_delay);}
var _slideshow_pressed=0;var slideshow_button=function(){if(_slideshow_pressed){clearTimeout(_slideshow_pressed);_slideshow_pressed=0;}
var p=document.querySelector('#projected');if(slideshow_id){clearTimeout(slideshow_id);slideshow_id=false;document.querySelector('#slide_button').classList.remove('icon_stop');document.querySelector('#slide_button').classList.add('icon_play');p.style.transform='translate(0, 0) scale(1.0)';setTimeout(_set_image,300);}else{document.querySelector('#slide_button').classList.remove('icon_play');document.querySelector('#slide_button').classList.add('icon_stop');slideshow_id=1;_slideshow_pressed=setTimeout(next_image,1300);p.style.transform='translate(0, 0) scale(1.1)';setTimeout(function(){var o=p.offsetTop/2;p.style.transform='translate(0, -'+o+'px) scale(1.1)';},300);}}
var _image_setter=0;var view_image=function(obj,counter){if(expertise_level==0){display_popup('Click on the "play" icon to start slideshow, you can use ARROWS and ESCAPE here');expertise_level++;}
cur_image=counter;if(document.querySelector('#projector').classList.contains('slide-down')){document.querySelector('div#container').style.visibility='hidden';DC('#projector','slide-down');document.querySelector('#projected').src=pass+'/'+data[cur_image].t;}
if(!!_image_setter){clearTimeout(_image_setter)}
_image_setter=setTimeout(_set_image,250);}
var next_image=function(user_action){var user_action=user_action||false;if(user_action&&!!slideshow_id){if(cur_image+1<data.length)
cur_image++;slideshow_button();}else{if(cur_image+1<data.length){_set_left_image(pass+'/'+data[cur_image].f);document.querySelector('#next_button').classList.add('busy');setTimeout(function(){cur_image++;_set_image();if(cur_image+1<data.length){_set_right_image(pass+'/'+data[cur_image+1].f);}},10);}else{if(!!slideshow_id){_set_image();slideshow_button();}}}}
var prev_image=function(user_action){var user_action=user_action||false;if(user_action&&!!slideshow_id){if(cur_image>0)
cur_image--;slideshow_button();}else{if(cur_image>0){AC('#prev_button','busy');setTimeout(function(){_set_right_image(pass+'/'+data[cur_image].f);cur_image--;if(cur_image>0){_set_left_image(pass+'/'+data[cur_image-1].f);}
_set_image();},10);}}}
var close_projector=function(){AC('#projector','slide-down');document.querySelector('div#container').style.visibility='visible';AC('#projected','loading');if(slideshow_id)slideshow_button();}
function start_process(){var container=QS('#container');isotope=new Isotope(container,{itemSelector:'.item',isFitWidth:true,filter:'.p0'});QS('#dl_ref').setAttribute('href','./'+pass+'/package.zip');var xhr=new XMLHttpRequest();xhr.open('GET','./'+pass+'/images.js',true);xhr.overrideMimeType('text/javascript; charset=utf-8');xhr.onreadystatechange=function(e){if(this.readyState==4&&this.status==200){data=JSON.parse(this.responseText);if(!!data.version){data=uncompress_resources(data);}
var pages=QS('#pages #page_list');for(var i=0;i<data.length;i=i+page_size){var p=i/page_size;var btn=document.createElement('button');btn.onclick=function(){var page=p;return function(){switch_page(page)};}();btn.innerHTML='&nbsp;'+(p+1)+'&nbsp;';pages.appendChild(btn);};var html=[];var d={};var counter=0;for(var i in data){d=data[i];if(!!!d.s){var size='';}else{if(d.s>1100000){var size="&nbsp;"+(Math.floor(d.s/1000)/1000.0)+" MB";}else{var size="&nbsp;"+Math.floor(d.s/1000)+" kB";}}
html.push('<div title="'+d.f+size+'" class="item p'+Math.floor(counter/page_size)+'" ><img class="tn" onclick="view_image(this, '+counter+')" src="'+pass+'/'+d.t+'" ></img></div>');counter++;};setTimeout(function(){var e=document.createElement('div');e.innerHTML=html.join('');isotope.insert(e);if(data.length>page_size)
QS('button').classList.add('current');},100);for(n=1;n<5;n++){setTimeout(function(){isotope.arrange();},n*2*100);}}else if(this.readyState==4){display_popup("<h1>Error loading images</h1>Perhaps the code is incorrect.",{'flush':true});}};xhr.send(null);QS('#projected').onload=function(e){DC('button.busy','busy');DC('#projected','loading');if(!!slideshow_id){_start_show();}};document.onkeydown=function(e){switch(e.which){case 27:if(!!slideshow_id){slideshow_button();}else{close_projector();}
break;case 37:prev_image(true);break;case 38:prev_image(true);break;case 39:next_image(true);break;case 40:next_image(true);break;default:return;}
e.preventDefault();};if(expertise_level==0)
display_popup('Welcome ! Click on an image to launch the viewer !');}
function _start_bootstrap(code){remove_popup();pass=code||QS("#codepopup input").value;start_process();}
function change_code(){QS('#container').innerHTML='';QS('#page_list').innerHTML='';display_popup('<form action="#" onsubmit="_start_bootstrap(); return false;" id="codepopup" >Code: <input type="text" ></input></form>',{'stay':true});QS('#codepopup input').focus();}
function uncompress_resources(keys_values_array){var keys=keys_values_array.c;var list_of_values=keys_values_array.r;var ret=[];for(var i=0;i<list_of_values.length;i++){var values=list_of_values[i];var item={};for(var pid=0;pid<keys.length;pid++){item[keys[pid]]=values[pid];}
ret.push(item);}
return ret;};var default_configuration={}
document.addEventListener('DOMContentLoaded',function(){var options=document.location.href.match('.*#(.*)');if(!!options){options=options[1].split(/ *,/);var tmp=null;for(var i=0;i<options.length;i++){tmp=options[i].split(/=/);default_configuration[tmp[0]]=tmp[1]}}
if(!!!default_configuration.code){display_popup('<form action="#" onsubmit="_start_bootstrap(); return false;" id="codepopup" >Code: <input type="text" ></input></form>',{'stay':true});QS('#codepopup input').focus();}else{_start_bootstrap(default_configuration.code);}});

        </script>
    </head>
    <body>
        <div id="global_container">
            <span class="pull-right"><h1><a id="dl_ref" title="Download all images" class="bg_caption" href=""><div class="icon_hdd" ></div></a>&nbsp;<a class="bg_caption" href="#" title="Change current code" onclick="change_code()"><div class="icon_cycle" ></div></a></h1></span>
            <div id="pages"><span class="bg_caption"><span id="page_list" /></div>
            <hr />
            <div id="container">
            </div>
            <div id="popup"  class="slide-down">
            </div>
            <div id="projector"  class="slide-down">
                <div class="pull-right bigfont icon_cross" title="Close image viewer" onclick="close_projector()"></div>
                <span class="pull-right"><form action="#" onclick="return false;"><input class="bigfont" title="Slideshow delay" type="text" id="delay" size="3" value="3.5"></input>&nbsp;<div id="slide_button" class="bigfont icon_play" title="Toggle slideshow mode" onclick="slideshow_button(); false;"></div></form></span>
                <h1 id="projected_name">IMG XXX</h1>
                <br />
                <div id="next_button" title="Show next image" onclick="next_image(true)" class="pull-right bigfont icon_right"></div>
                <div id="prev_button" title="Show previous image" onclick="prev_image(true)" class="bigfont icon_left"></div>
                <img title="Use Arrow keys to change current image" id="projected" class="loading" />
                <img class="cache" id="next_projected" />
                <img class="cache" id="prev_projected" />
            </div>
        </div>
    </body>
</html>
"""

if __name__ == "__main__":
    import argparse

    parser = argparse.ArgumentParser(description='Make HTML5 Photo gallery.')
    parser.add_argument('input', metavar='FOLDER', type=str, help='folder with original images')
    parser.add_argument('-o', '--output', metavar='FOLDER', type=str, help='destination folder')
    parser.add_argument('-f', '--overwrite', action='store_true', help='overwrite files', default=False)
    parser.add_argument('-c', '--copy', action='store_true', help='copy original images', default=False)
    parser.add_argument('-s', '--resize', metavar='SIZE', action='store', help='resize original images when copying (give a maximum width or height in pixels, i.e: "1280") -- Implies "-c"', default=False)
    parser.add_argument('-q', '--quality', metavar='QUALITY', action='store', type=int, help='Output image quality in range [0-100]', default=90)
    args = parser.parse_args()

    if args.resize and not args.copy:
        args.copy = True

    print("Listing...")
    images  = ImageList(args.input, overwrite=args.overwrite)
    out = Output(args.output or args.input)
    if not os.path.exists(out.path):
        os.makedirs(out.path)
    print("\nWriting web page")
    w = HTMLWriter(images, out)
    w.write()
    w = JSONWriter(images, out)
    w.write()
    package_files = []
    if args.copy:
        noop = args.input == args.output
        img_mgr = ImageHandler()
        print("\nCopying...")
        sz = int(args.resize)
        for i, fname in enumerate(images.filenames):
            print('\r' + progress_maker(i, len(images.filenames)), end='')
            out_fname = os.path.join(out.path, os.path.basename(fname))
            package_files.append( out_fname )
            if noop or ( os.path.exists(out_fname) and not args.overwrite):
                continue
            rot = img_mgr.get_rotation(fname)
            if args.resize:
                src_img = img_mgr.minify( fname , sz )
                img_mgr.current_img = src_img
            src_img = img_mgr.rotate( fname, rot )
            img_mgr.save( src_img, out_fname, quality=args.quality)


    print("\nMaking thumbnails...")
    images.make_thumbs(out) # TODO: re-use scaled+rotated images instead of originals

    zfname = os.path.join(out.path, 'package.zip')

    if not os.path.exists(zfname) or args.overwrite:
        print("\nZipping...")
        import zipfile
        z = zipfile.ZipFile( zfname, 'w')
        for i, fname in enumerate(package_files or images.filenames):
            print('\r' + progress_maker(i, len(images.filenames)), end='')
            z.write( fname, os.path.basename(fname) )
        z.close()

    print("\n%d files processed."%len(images))
    open(os.path.join(out.path, os.path.pardir, 'index.html'), 'w').write(INDEX)

