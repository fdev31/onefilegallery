#!/usr/bin/env python
from __future__ import print_function
import os
import sys

TMP='/tmp/'

class FatalError(SystemExit): pass

def progress_maker(cur, maxi):
    if cur == maxi:
        return ' Done!'
    return '%5.1f%%'%((cur*100.0/maxi))


def dontloadtwice(decorated):
    def _decorator(self, img=None, *args, **kw):
        if isinstance(img, str):
            if self.current_img_name != img:
                self.current_img_name = img
                img = self.current_img = self._load(img)
            else:
                img = self.current_img
        img = decorated(self, img or self.current_img, *args, **kw )
        return img
    return _decorator


class BaseImageHandler:

    MAX_SZ = 200 # pixels

    _rot_map = {
            6: 270,
            8: 90,
            1: 0,
        }

    def __init__(self):
        self.current_img_name = ''

    @dontloadtwice
    def get_rotation(self, img):
        r = self._exif_rot(img)
        if r:
            return self._rot_map[r]
        return 0

class JpegTranHandler(BaseImageHandler):

    _rot_map = {
            6: 270,
            8: -90,
            1: 0,
        }

    def _load(self, img):
        return jpegtran.JPEGImage( img )

    def _exif_rot(self, img):
        return img.exif_orientation

    @dontloadtwice
    def minify(self, img, size=None):
        w, h = img.width, img.height
        size = size or self.MAX_SZ
        if w > h:
            aspect = h/w
            nw = size
            nh = int(aspect * size)
        else:
            aspect = w/h
            nh = size
            wh = int(aspect * size)
        img = img.downscale(nw, nh)
        return img

    @dontloadtwice
    def save(self, img, path, quality):
        return img.save(path)

    @dontloadtwice
    def rotate(self, img, angle):
        if angle:
            return img.rotate(angle)
        return img


class PILHandler(BaseImageHandler):
    def _load(self, img):
        return Image.open( img )

    def _exif_rot(self, img):
        e = img._getexif()
        if e and 274 in e:
            return e[274]

    @dontloadtwice
    def rotate(self, img, angle):
        if angle:
            return img.rotate(angle)
        return img


    @dontloadtwice
    def minify(self, img, size=None):
        sz = size or self.MAX_SZ
        imgcopy = img
#        imgcopy = img.copy() # XXX: commenting this is a bug that is a speed boost
        imgcopy.thumbnail( (sz, sz), Image.ANTIALIAS )
        return imgcopy

    @dontloadtwice
    def save(self,img , path, quality):
        img = img.save( path, quality=quality, progressive=True, optimize=True)
        return img

try:
    import jpegtran
    ImageHandler = JpegTranHandler
except:
    from PIL import Image
    ImageHandler = PILHandler

class ImageList:

    filenames = []
    infos = []

    def __init__(self, path, overwrite=False):
        files = [fname for fname in os.listdir(path) if fname.rsplit('.')[-1].lower() in ('jpg', 'jpeg')]
        files.sort()
        filenames = []
        infos = []
        for i, name in enumerate(files):
            print('\r' + progress_maker(i, len(files)), end='')
            fullpath = os.path.join(path, name)
            filenames.append(fullpath)
            infos.append(dict(t='tn/'+name, f=name, s=os.stat(fullpath).st_size)) # more info to come ?
        print('\r' + progress_maker(len(files), len(files)), end='')
        self.filenames = filenames
        self.infos = infos
        self.overwrite = overwrite

    def __len__(self):
        return len(self.filenames)

    def make_thumbs(self, out):
        tn_path = os.path.join(out.path, 'tn')
        img_mgr = ImageHandler()
        if not os.path.isdir(tn_path):
            try:
                os.makedirs( tn_path )
            except OSError:
                print('%s must be a valid folder'%tn_path)
                raise FatalError()
        for i, fullpath in enumerate(self.filenames):
            print('\r' + progress_maker(i, len(self.filenames)), end='')
            name = os.path.basename(fullpath)
            t_tn_path = os.path.join( tn_path, name )
            if self.overwrite or not os.path.exists(t_tn_path):
                rot = img_mgr.get_rotation( fullpath )
                src_img = img_mgr.minify( fullpath )
                src_img = img_mgr.rotate( src_img, rot)
                img_mgr.save(src_img, t_tn_path, quality=60 )
        print('\r' + progress_maker(len(self.filenames), len(self.filenames)), end='')

class Output:
    path = None
    def __init__(self, path):
        self.path = path
    def open_file(self, name, mode='w'):
        return open(os.path.join(self.path, name), mode)

class Writer:
    def __init__(self, images, out):
        self.out = out
        self.images = images

class JSONWriter(Writer):
    def write(self, index='images.js'):
        import json
        c = list(self.images.infos[0].keys())
        r = [list(i.values()) for i in self.images.infos]
        json.dump({'c': c, 'r': r, 'version': 1}, self.out.open_file(index))

class HTMLWriter(Writer):

    def write(self, index='index.html'):
        tn_path = os.path.join(self.out.path, 'tn')
        fd = open(os.path.join(self.out.path, index), 'w')

        fd.write("""<!DOCTYPE HTML>
            <html>
            <head>
            <title>Gallery</title>
            </head>
            <body>
            <a href="package.zip">Download all files</a><br/>
            <div id="container">""")

        for i in self.images.infos:
            fd.write('<a href="%(f)s"><img src="%(t)s" /></a>\n'%i)

        fd.write("</div></body></html>")

INDEX = """
<!DOCTYPE HTML>
<html>
    <head>
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">

        <meta charset="utf-8"> 
        <title>Gallery</title>
        <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>
        <style>
body{background:[[BACKGROUND_COLOR]];margin:0;padding:0;font-family:'PT Sans',sans-serif}#global_container{padding:1ex}img{border:none;margin:1ex;border:[[TN_BORDER]];border-radius:3px}img.tn:hover{border:[[HIGHLIGHT_TN_BORDER]];transform:scale(1.2);z-index:3;transition-duration:300ms}a{font-weight:bold}h1{margin:0;color:[[PICTURE_TITLE]]}button{font:bold 20px/1 "helvetica neue",helvetica,arial,sans-serif;margin:2px 1ex;text-align:center;text-shadow:0 3px 0 [[BUT_TEXT_SHADOW]];cursor:pointer;color:[[BUT_TEXT]];background:[[BUT_COLOR]];border:[[BUT_BORDER]];border-radius:3px;margin-right:1ex;padding:5px}button:hover{border-color:[[ACTIVE_COLOR]];transition-duration:300ms;transform:scale(1.25)}button.current{color:[[ACTIVE_COLOR]]}hr{margin:.5ex auto 0 auto;width:50%}input#delay{border-radius:3px;float:left;font-size:150%;background-color:white;padding:0.4ex 0px 0px;text-align:center;border:medium none}button.busy{color:[[BUSY_COLOR]]}#projector{position:fixed;top:0;left:0;width:98%;height:98%;background-color:[[PROJ_BACKGROUND]];margin:0;padding:1%;z-index:3;transition-property:top;transition-duration:230ms;transition-timing-function:ease-in}#projected{display:block;position:relative;top:-64px;margin:auto auto 0 auto;min-width:10px;min-height:10px;max-width:90%;max-height:90%;transition-property:opacity,transform;transition-duration:1000ms}#popup{position:fixed;left:50%;top:50%;text-align:center;background:[[POPUP_BACKGROUND]];padding:1ex;border:[[POPUP_BORDER]];color:black;font-weight:bold;transition-property:top;transition-duration:230ms;transition-timing-function:ease-in;z-index:42;margin-left:-40ex;width:80ex}.cache{display:block;width:1px;height:1px;opacity:0.1;margin-top:1ex;border:none}.slide-down{top:101%!important}.pull-right{float:right}.bg_caption{text-decoration:none}.bigfont{font-size:200%;font-weight:bold}.loading{opacity:0.0}.icon_cross,.icon_cycle,.icon_hdd,.icon_left,.icon_pack,.icon_play,.icon_right,.icon_stop{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSI2NHB4IgogICB2aWV3Qm94PSIwIDAgNjQgNTEyIgogICBoZWlnaHQ9IjUxMnB4IgogICBpZD0ic3ZnMiIKICAgdmVyc2lvbj0iMS4xIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29ucy5zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMxOSIgLz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MTgiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1OSIKICAgICBpZD0ibmFtZWR2aWV3MTciCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6em9vbT0iMy40NzY2MDgzIgogICAgIGlua3NjYXBlOmN4PSItMi42NTEzMjUzIgogICAgIGlua3NjYXBlOmN5PSI4Ni43MTUxODIiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMiI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgaWQ9ImdyaWQzNzc0IiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogICAgICAgIAo8c3ZnCnk9IjAiCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIAogICB2ZXJzaW9uPSIxLjEiCiAgIHdpZHRoPSI2NCIKICAgaGVpZ2h0PSI2NCIKICAgaWQ9InN2ZzM4MDkiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuNDguNSByMTAwNDAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Imljb25fcGFjay5zdmciPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiM2MzYzNjMiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC42Nzg0MzEzNyIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iOTU4IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwNTkiCiAgICAgaWQ9Im5hbWVkdmlldzI5OTgiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjUuMjE0OTEyNSIKICAgICBpbmtzY2FwZTpjeD0iMTUuNzY0OTcyIgogICAgIGlua3NjYXBlOmN5PSIzOS42MjgyNDQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlkPSJnMjk4OSIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLjg0ODYzNDk0LC0wLjcyNjc5NTYxLDAuNzcyMTE4NjYsMC43OTg4MjA0MiwtMTUuMjUzNTgxLDI3LjEzNTgwNykiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICBkPSJtIDI3LjYxMzExOSwzLjk3OTgxNzYgYyAzLjE4NzAxNCwwIDUuNzUyNzMzLDIuNTY1NzE5IDUuNzUyNzMzLDUuNzUyNzMzMyBsIDAsNDYuMDIxODY2MSBjIDAsMy4xODcwMTQgLTIuNTY1NzE5LDUuNzUyNzMzIC01Ljc1MjczMyw1Ljc1MjczMyAtMy4xODcwMTQsMCAtNS43NTI3MzMsLTIuNTY1NzE5IC01Ljc1MjczMywtNS43NTI3MzMgbCAwLC00Ni4wMjE4NjYxIGMgMCwtMy4xODcwMTQzIDIuNTY1NzE5LC01Ljc1MjczMzMgNS43NTI3MzMsLTUuNzUyNzMzMyB6IgogICAgICAgaWQ9InJlY3QyOTg1IiAvPgogICAgPHBhdGgKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAsLTEsMSwwLDAsMCkiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIgogICAgICAgZD0ibSAtMzIuNzQzNDgzLC0xLjE1MDU0NzUgYyAzLjE4NzAxNSwwIDUuNzUyNzM0LDIuNTY1NzE5IDUuNzUyNzM0LDUuNzUyNzMzMiBsIDAsNDYuMDIxODY2MyBjIDAsMy4xODcwMTQgLTIuNTY1NzE5LDUuNzUyNzMzIC01Ljc1MjczNCw1Ljc1MjczMyAtMy4xODcwMTQsMCAtNS43NTI3MzMsLTIuNTY1NzE5IC01Ljc1MjczMywtNS43NTI3MzMgbCAwLC00Ni4wMjE4NjYzIGMgMCwtMy4xODcwMTQyIDIuNTY1NzE5LC01Ljc1MjczMzIgNS43NTI3MzMsLTUuNzUyNzMzMiB6IgogICAgICAgaWQ9InJlY3QyOTg3IiAvPgogIDwvZz4KPC9zdmc+Cgo8c3ZnCnk9IjY0IgogICAKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgdmVyc2lvbj0iMS4xIgogICB3aWR0aD0iNjQiCiAgIGhlaWdodD0iNjQiCiAgIGlkPSJzdmczODA5IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29uX2N5Y2xlLnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzdmN2Y3ZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY2Mjc0NTEiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjgwOCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIzNjQiCiAgICAgaWQ9Im5hbWVkdmlldzciCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjMuNjg3NSIKICAgICBpbmtzY2FwZTpjeD0iMzIiCiAgICAgaW5rc2NhcGU6Y3k9IjMyIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIxMTEwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIzNjYiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmczODA5IiAvPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMzODExIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTM4MTQiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaWQ9ImxheWVyMSIKICAgICBzdHlsZT0iZmlsbDojZmZmZmZmIj4KICAgIDxwYXRoCiAgICAgICBkPSJtIDM2LjA5NjI3MSwxLjg3NTg4ODMgYyAtOC40MzE2NTMsMCAtOC44NTE1MzUsMC4wODc4MyAtNy41NjU2NTIsMS41NjMzODYgMC43NDkzNDEsMC44NTk4NjEgMi45ODA0OTMsNC41NDA3NjcgNC45NjkzMTksOC4xNzk4MzA3IGwgMy42MjkyNzksNi42MTY0NjUgLTEuOTI2MzA3LDEuNjQ3MTM1IGMgLTEuOTA0MzY0LDEuNjE0ODA4IC0xLjgxMTI5OCwxLjYzODU0MSA1LjYxMTQyMiwxLjQyMzc5MSBsIDcuNTM3NzM5LC0wLjIyMzMzNiAzLjM3ODAyLC01LjgwNjg1MyBjIDMuOTc0NTUxLC02LjgzMjcwNDcgNC4xNzk1MjQsLTcuODcwNDc3NyAxLjIwMDQ1NSwtNS45MTg1MTY3IC0yLjE1MzY2MywxLjQxMTEyNzcgLTIuMjQ4NzA4LDEuMzgzOTA3NyAtMy42ODUxMTUsLTEuNDUxNzEzIC0yLjk1NTk3MywtNS44MzUzOTUgLTMuMzkwNTk5LC02LjAzMDE4OSAtMTMuMTQ5MTYsLTYuMDMwMTg5IHogbSAtMTMuODE5MTg2LDAuODkzMzYxIGMgLTMuMjk3NDQ5LDAuMTk0OTI1IC00LjkxNzg0MiwyLjAyNDU0NyAtOS40NjQwNDYsOS45Mzg2NDc3IGwgLTIuMzcyOTg3LDQuMTAzODczIDYuMDU4MTAyLDMuNjU3MjAyIGMgMy4zMjU5OCwyLjAwNzkyOSA2LjMzNzk1OCwzLjU2MzQ3OCA2LjcwMDIxNCwzLjQ2MTc3IDAuMzYyMjU2LC0wLjEwMTY5IDIuNDE1NDMsLTMuMTgyNTk5IDQuNTc4NDc2LC02Ljg2NzcxNCAzLjY2NzA3MSwtNi4yNDc0NiAzLjg0NjA1MywtNi44NjEzNzcgMi43MDgwMDUsLTkuMDczMjAwNyAtMi4wMzE5NDQsLTMuOTQ5MDg0IC0zLjg0MzYxNiwtNS4yMjA1NzggLTcuNTA5ODI2LC01LjIyMDU3OCAtMC4yMzYwNTUsMCAtMC40NzgxMDgsLTAuMDEyOTMgLTAuNjk3OTM4LDAgeiBNIDU1Ljk0NTY0NSwyMC42MzY0OCBjIC0xLjE2MjEzNywwIC0xMi40MTUyNjYsNi43MDAxNTggLTEyLjQyMzMwOCw3LjM5ODE0NCAtMC4wMDQ3LDAuMzg0MzY3IDEuNzA4NTU4LDMuNjY3OTE1IDMuNzk2Nzg3LDcuMzE0MzkzIDMuNzQ3Nyw2LjU0NDI3MiAzLjg0ODc1Myw2LjY1NjU0NSA3LjgxNjkxLDYuOTc5Mzg2IDIuMjExMDY2LDAuMTc5ODkxIDAuMTAwNSwwLjM4NjA3MyAtNC42OTAxNDgsMC40NzQ2MDMgbCAtOC43MTAyNywwLjE2NzUgMCwtMi4yMzM0MDIgYyAwLC0zLjQ4MDE1MSAtMS4wNDkwMjIsLTIuNjcyODA4IC00LjcxODA2MiwzLjYwMTM2NSBsIC0zLjQwNTk0Myw1LjgwNjg0NCAzLjQwNTk0Myw2LjIyNTYxMiBjIDMuNjA3ODcsNi42MjQ4MDYgNC43MTgwNjIsNy41ODIwMzYgNC43MTgwNjIsNC4wNDgwNDUgMCwtMi4wMzc2OTggMC4zNTk4MTgsLTIuMjA3MzE2IDUuMTM2ODI4LC0yLjQ1NjczNyBsIDUuMTM2ODI4LC0wLjI1MTI1OCA0LjI0MzQ2OCwtNy40NTM5ODkgYyAyLjM0MjY1NiwtNC4wOTEzMjIgNC4wNjQ0NzcsLTcuNzM2MDI5IDMuODI0NzAxLC04LjEyNDAwNSAtMC4yMzk3ODYsLTAuMzg3OTg1IDAuMzY4OTI5LC0xLjQzODMxIDEuMzQwMDQxLC0yLjMxNzE1MSAyLjc3NTIyOSwtMi41MTE1NDIgMi4yNzEwOTEsLTcuMDA0ODcyIC0xLjUzNTQ2MywtMTMuNTEyMDkyIC0xLjgyMTgwNSwtMy4xMTQzMzMgLTMuNTk4NzA0LC01LjY2NzI1OCAtMy45MzYzNzQsLTUuNjY3MjU4IHogbSAtNDAuMjU3MDkzLDIuNjgwMDgyIC03Ljc2MTA4MzIsMC4wMjc4NCBjIC03LjAwMDU1MDc2LDAuMDI1NjggLTcuNTcwNzIzMTIsMC4xNTM3MiAtNi4wMDIyNjYyLDEuMzQwMDUgMC45NTM3NzEsMC43MjEzOSAyLjA5NDQzNDQsMS4zMTIxMTggMi41MTI1NzMzLDEuMzEyMTE4IDAuNDE4MTU3NywwIC0wLjI1ODQ1NjksMS43NDkxNDQgLTEuNTA3NTQwMiwzLjg4MDUzNyAtMS4yNDkwODMzLDIuMTMxNDAyIC0yLjI4OTIzODA2LDQuNDAxMzYgLTIuMjg5MjM4MDYsNS4wNTMwNzkgMCwwLjY1MTcxOSAxLjkxNTA2ODg2LDQuNTYyMTI5IDQuMjQzNDU4NTYsOC43MTAyNzEgMy4wOTczODY2LDUuNTE4MTc3IDQuMzU1OTkzMSw3LjEwNDEzNCA0LjY5MDE0ODIsNS44OTA2MDMgMC4yNTExOTI2LC0wLjkxMjI0OCAyLjE3NzE0MzYsLTQuNzYzNjA2IDQuMjk5MzAzNiwtOC41NzA2ODUgMy40OTU2NDUsLTYuMjcxMDQzIDQuMDM1MTM5LC02Ljg0Nzg0MiA1LjY2NzI1OSwtNS45NzQzNTMgMi45ODg3MjMsMS41OTk1MSAyLjg1NzUyNiwwLjM1MTIzMyAtMC41ODYyNjcsLTUuODA2ODU0IGwgLTMuMjY2MzQ4LC01Ljg2MjY4IHogbSAxNS40MTA0NzYsMTkuNTcwMTk0IC04Ljc2NjEwNywwLjI3OTE3MiAtOC43MzgxODQsMC4yNTEyNTggLTEuNzAyOTcyLDMuMTgyNjA4IGMgLTEuOTk0MjI1NCwzLjcyNDU3NiAtMS40ODk5MzcsNy4wMDQ1NjIgMS40Nzk2MjcsOS43NzExMzEgMS43MzE5MDcsMS42MTM0NzYgMi45MTA1MjIsMS44MTQ2NzIgOS41NzU3MTgsMS41OTEzMDggbCA3LjYyMTQ4OCwtMC4yNTEyNTggMC4yNTEyNTgsLTcuMzk4MTUzIDAuMjc5MTcyLC03LjQyNjA2NiB6IgogICAgICAgaWQ9InBhdGgyOTk4IgogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZiIgLz4KICA8L2c+Cjwvc3ZnPgoKPHN2Zwp5PSIxMjgiCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIAogICB2ZXJzaW9uPSIxLjEiCiAgIHdpZHRoPSI2NCIKICAgaGVpZ2h0PSI2NCIKICAgaWQ9InN2ZzM4MDkiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuNDguNSByMTAwNDAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Imljb25faGRkLnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzFlMWUxZSIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjM0OTAxOTYxIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxOTIwIgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwODAiCiAgICAgaWQ9Im5hbWVkdmlldzI5ODkiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjMuNjg3NSIKICAgICBpbmtzY2FwZTpjeD0iLTIuNjEyNDI0OCIKICAgICBpbmtzY2FwZTpjeT0iNDMuMjAyMzUzIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8cGF0aAogICAgIHN0eWxlPSJmaWxsOiNmZmZmZmYiCiAgICAgZD0iTSAzMS42ODc1LDEuNTMxMjUgQyAzMS4zMTIwNCwxLjU3NDM0NzcgMzAuOTY0NzU1LDEuNzE1Mzc4NCAzMC42NTYyNSwyIDMwLjI1NTc3OSwyLjMxNjQ0NzggMjkuOTI5NDksMi43MTAxNzA5IDI5LjU2MjUsMy4wNjI1IGMgLTguNmUtNCwwLjA4OTc5OCA4LjZlLTQsMC4xOTE0NTIxIDAsMC4yODEyNSAtMC4wMTA5LDIuMzc5ZS00IC0wLjAyMDM2LC0yLjQxMmUtNCAtMC4wMzEyNSwwIGwgMCw0LjY4NzUgYyAwLjAxMDM5LC0yLjYzZS01IDAuMDIwOTIsNy4xN2UtNSAwLjAzMTI1LDAgMC4wMDEzLDEuMzc2NzkyMyAwLjIxNjMzLDIuNjA5NjM4IC0wLjA2MjUsMy44NDM3NSAtMC41MDYxMDcsMi4yNDAwNSAtNy4zMTc5OTgsMC41OTA1NDIgLTEwLjA5Mzc1LDEuNjU2MjUgLTAuOTk0Njk2LDAuNTgxNTU5IC0wLjA0MywxLjc4ODcxNCAwLjQ2ODc1LDIuMzc1IDMuNjczNTE5LDMuNTgwOCA3LjIzMjI1LDcuMjkyMzM4IDEwLjkzNzUsMTAuODQzNzUgMS4xNTQzMjksMC44MzQxNzUgMi42NjM1MjgsMC4wOTc4NCAzLjQ2ODc1LC0wLjg3NSAxLjk3MzY4MywtMi4xMjE1MjcgNC4wOTM4MzgsLTQuMTE3OTQyIDYuMTI1LC02LjE4NzUgMS4zODQ5OTYsLTEuNDE2MDA5IDIuODI4NDUxLC0yLjc4MjgzNCA0LjE1NjI1LC00LjI1IDAuNjAzODAxLC0wLjc0Mjk4NyAwLjI3NTA5NSwtMi4wNjczNjkgLTAuNzUsLTIuMTg3NSAtMi42OTI2MjMsMC4yMzMwMyAtNS4zOTA0NzYsMC4xMDk4NTMgLTcuOTA2MjUsLTAuMDYyNSAtMS4xMDA3OTMsLTAuMjY0NTU0IC0xLjY2MjE3NiwtMS4zODk1NzIgLTEuNjg3NSwtMi40Njg3NSBsIC0wLjA2MjUsMCAwLC04LjAzMTI1IEMgMzMuNjY5Mzc0LDIuMDUyNjY0MSAzMi44NjQxMjEsMS41NzYwNzkzIDMyLjA2MjUsMS41MzEyNSBjIC0wLjEyNjc5NywtMC4wMDcwOSAtMC4yNDk4NDcsLTAuMDE0MzY2IC0wLjM3NSwwIHogbSAtNi4yNSwyIEMgMTcuNTY4MjM4LDQuMDk1NDU0MSAxMi4xNjcxOTQsNS44MzE4OTU3IDYuNzE4NzUsOS40Mzc1IGMgLTUuNjEwODE4NCwzLjcxMzA2OCAtNS45Mzc1LDQuODkyOTM2IC01LjkzNzUsMjQgMCwxNi43MzU5NTYgMC4wMzg5MDA1LDE2Ljk3NDA3MyAyLjE1NjI1LDE5Ljc1IDIuNTQyMzAxMywzLjMzMzEzNyA5Ljc3NDA4Nyw2Ljk3MDQ1OSAxNy4wOTM3NSw4LjU2MjUgMTQuMDkzNzE1LDMuMDY1Mzg5IDMxLjYzNjU4MywwLjAxNDg5IDM5LjA5Mzc1LC02Ljc4MTI1IDQuMDc1MzAzLC0zLjcxNDA1MSA0LjQzNzUsLTUuNTA4OTk1IDQuNDM3NSwtMjIuMDYyNSAwLC0xNy42NzgxMjUgLTAuMzMxNzMyLC0xOS4wMDgxMDggLTYuMTg3NSwtMjMuMjUgQyA1Mi41MDIzLDYuMTI2NDc3MyA0Ni40NDI1ODEsNC4xOTUyMjE1IDM4LjI1LDMuNTYyNSBjIDAsMCAtMC41NzUzMzIsMi4zOTgyMTAxIDAsNC44MTI1IDAuOTE0MzE1LDAuMTc3MDAxOCAxLjcxMTUyNywtMC42Njc3MzI4IDEwLjYyNSwyLjAzMTI1IDguNzMxNDQyLDIuNjQzODY0IDExLjY1Njk0Niw4LjM0MzA1NSA3LjcxODc1LDEyLjI4MTI1IC0yLjcyMTQxNSwyLjcyMTQwNiAtOS45NzkyOCw1LjcxMDY4OCAtMTYuMjUsNi43MTg3NSAtOC43ODQyMiwxLjQxMjE0MyAtMTUuNjcxMDc0LDAuODgzNDQxIC0yMy45Mzc1LC0xLjgxMjUgQyAxMC42MTc3NDUsMjUuNzA1OTQzIDUuMDkzNzUsMjEuNjQwNzYxIDUuMDkzNzUsMTkuMjUgYyAwLC0zLjk4NTEyNiA2LjY3MjMzOCwtOC40NTM4MjYgMTUuNTkzNzUsLTEwLjQzNzUgMS4zMzExMzksLTAuMjk1OTc1OCAyLjk2MjYyMSwtMC40OTA5NTcgNC43NSwtMC42MjUgeiBNIDUuMDkzNzUsMjcuODEyNSA5LjI1LDI5LjkwNjI1IGMgMTIuMTA3MjI0LDYuMDgxMTE0IDMzLjM1NTcxNSw2LjI2NzAxIDQ0Ljg0Mzc1LDAuNDA2MjUgMS44NTc5OTQsLTAuOTQ3ODY4IDMuNTg4NDUsLTEuNzE4NzUgMy44NDM3NSwtMS43MTg3NSAwLjI1NTMsMCAwLjQ2ODc1LDEuNTU2NTc0IDAuNDY4NzUsMy40MDYyNSAwLDQuMTM4Mjg1IC0yLjc0NTM3LDYuNzQ2NjI3IC0xMC4wNjI1LDkuNTYyNSAtNi4xNjczNDgsMi4zNzMzOTYgLTIxLjUwMDI3OSwzLjEzMTY3NCAtMjguMTg3NSwxLjM3NSBDIDkuNDczMjM5Miw0MC4xMzExNTUgNS4wOTM3NSwzNi43MTQ1MzMgNS4wOTM3NSwzMS4yNSB6IG0gNTMuMzEyNSwxNC41MzEyNSAwLDMuNDY4NzUgYyAwLDIuNjcyNjUxIC0wLjUzNDM0LDQuMDAzNzMyIC0yLjI1LDUuNTkzNzUgQyA1My41MjgzMTksNTMuODQxNzMgNDYuMjAwMTIxLDU2Ljc2MjczIDQxLDU3LjQzNzUgMzMuODAxMjgsNTguMzcxNjE2IDMxLjIyMDQzNSw1OC40MzUxNTggMjUuMTg3NSw1Ny44MTI1IDE4LjExNjgxMyw1Ny4wODI3MTcgOS4yNTMyODE5LDUzLjQ2MzY1OSA2Ljc1LDUwLjI4MTI1IDQuODU1NzM2OSw0Ny44NzMwODggNC4zODk5NzI2LDQxLjg3ODQzIDYuMTU2MjUsNDIuNjU2MjUgYyAxMy4wMTU4MTgsNS43MzE4NjYgMjEuODAzMjA1LDcuMjUyNDg5IDMzLjA5Mzc1LDUuNzUgNy4yMjk0NTksLTAuOTYyMDY3IDExLjc1NTU4LC0yLjIzNDA3IDE2LjUsLTQuNjg3NSB6IgogICAgIGlkPSJwYXRoMzAwMCIKICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0ic2NjY2NjY3NjY2NjY2NjY2NjY2NzY3Nzc3Nzc3NjY3Nzc3Nzc2NjY2Nzc3Nzc3NjY3Nzc3Nzc3NjYyIgLz4KPC9zdmc+Cgo8c3ZnCnk9IjE5MiIKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIHZlcnNpb249IjEuMSIKICAgd2lkdGg9IjY0IgogICBoZWlnaHQ9IjY0IgogICBpZD0ic3ZnMzgwOSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC41IHIxMDA0MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iaWNvbl9yaWdodC5zdmciPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiM2MzYzNjMiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC42Nzg0MzEzNyIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iOTU4IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwNTkiCiAgICAgaWQ9Im5hbWVkdmlldzI5OTgiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjUuMjE0OTEyNSIKICAgICBpbmtzY2FwZTpjeD0iMTUuNTM2NjY2IgogICAgIGlua3NjYXBlOmN5PSIyNi4wMzc3MzUiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlkPSJnMzAyNCIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgtMS4zMzA4ODEzLDAsMCwxLjMzMDg4MTMsNzIuNTEzNzEyLC0xMC43MTY1MjQpIj4KICAgIDxwYXRoCiAgICAgICBpZD0icmVjdDI5ODUiCiAgICAgICBkPSJtIDE1LjM3NSw4LjYyNSBjIC0xLjQ3NTg5NCwwLjA2NzY1OSAtMi45NDE3MzMsMC42MTE2MTUzIC00LjEyNSwxLjYyNSAtMi43MDQ2MTE0LDIuMzE2MzA4IC0yLjg5ODI1MzcsNi4yMzUzOTggLTAuNDM3NSw4Ljc4MTI1IGwgMjIsMjIuNzUgOS44MTI1LC04LjMxMjUgLTIyLjA2MjUsLTIyLjgxMjUgQyAxOS4xNzgzMjYsOS4yMjQyMDggMTcuMjcyNTc4LDguNTM4MDEwNCAxNS4zNzUsOC42MjUgeiIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPHBhdGgKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjYyIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICBpZD0icmVjdDI5ODciCiAgICAgICBkPSJNIDMzLjc4MTI1LDI0LjU2MjUgOS41LDQ1LjM0Mzc1IGMgLTIuNzA0NjExNiwyLjMxNjMwOCAtMi44OTgyNTM3LDYuMjM1Mzk3IC0wLjQzNzUsOC43ODEyNSAyLjQ2MDc1MywyLjU0NTg1MiA2LjYwNzg4OSwyLjcyMjU1OCA5LjMxMjUsMC40MDYyNSBMIDQyLjQ3MTkyOCwzMy41MDE1ODkgQyA0Mi4zMTk5OTQsMzMuMzQyOCA0MS43Mzg3NDksMzMuOTUyMzc1IDQxLjU5Mzc1LDMzLjc4MTI1IHoiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIiAvPgogIDwvZz4KPC9zdmc+Cgo8c3ZnCnk9IjI1NiIKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIHZlcnNpb249IjEuMSIKICAgd2lkdGg9IjY0IgogICBoZWlnaHQ9IjY0IgogICBpZD0ic3ZnMzgwOSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC41IHIxMDA0MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iaWNvbl9wYWNrLnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzYzNjM2MyIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY3ODQzMTM3IgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMTA4IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwNTkiCiAgICAgaWQ9Im5hbWVkdmlldzI5OTgiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjUuMjE0OTEyNSIKICAgICBpbmtzY2FwZTpjeD0iMTUuMzgxNDU2IgogICAgIGlua3NjYXBlOmN5PSIzOS42MjgyNDQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlkPSJsYXllcjEiCiAgICAgc3R5bGU9InN0cm9rZTpub25lO2ZpbGw6I2ZmZmZmZiI+CiAgICA8ZwogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMC45MDQ1NDI4OCwwLDAsMC45MDQ1NDI4OCwtMjUwLjgxOTE3LC0yNTUuMzQ2NDYpIgogICAgICAgaWQ9ImczODkxIgogICAgICAgc3R5bGU9InN0cm9rZTpub25lO2ZpbGw6I2ZmZmZmZiI+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Im0gMjk3Ljg1ODAzLDI4My42MzYwOSBjIC0zLjEwNDE0LDAgLTUuNTgzNjgsMi41MDY3NyAtNS41ODM2OCw1LjYxMDkxIGwgMCw1MS42Njk0MiBjIDAsMy4xMDQxMyAyLjQ3OTU0LDUuNjEwOTEgNS41ODM2OCw1LjYxMDkxIGwgMzMuOTM3ODUsMCBjIDMuMTA0MTMsMCA1LjYxMDkxLC0yLjUwNjc4IDUuNjEwOTEsLTUuNjEwOTEgbCAwLC0zMC40Nzg3IC0wLjEwODk1LC0wLjEwODk0IGMgLTAuMDcwNSwtMC4yNjI3MyAtMC4xOTg2NiwtMC41MjY5NiAtMC40MDg1NiwtMC43MzU0MiBMIDMxMS4yNTg4NSwyODQuMTUzNiBjIC0wLjEwNjU2LC0wLjEwNTgzIC0wLjIyOTkyLC0wLjE3NTEgLTAuMzU0MDksLTAuMjQ1MTQgLTAuMDg1OCwtMC4wODc0IC0wLjE3MDUzLC0wLjE3NzY5IC0wLjI0NTE0LC0wLjI3MjM3IGwgLTEyLjgwMTU5LDAgeiBtIDEzLjQwMDgyLDQuNzkzNzggMjEuNDkwMzQsMjEuMzU0MTYgLTE1Ljg3OTQzLDAgYyAtMy4xMDQxNCwwIC01LjYxMDkxLC0yLjQ3OTU0IC01LjYxMDkxLC01LjU4MzY4IGwgMCwtMTUuNzcwNDggeiIKICAgICAgICAgaWQ9InBhdGgzODAyIgogICAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxLjc0MzE5NjAwOTk5OTk5OTkxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1vcGFjaXR5OjE7c3Ryb2tlLWRhc2hhcnJheTpub25lIiAvPgogICAgICA8cGF0aAogICAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIgogICAgICAgICBkPSJtIDI5My4zMDY0NywyODcuOTY3NTMgYyAtNC42NDI3MywtMC4xMzc3NyAtNi4zNjE0MSw1LjEyNTExIC01LjU4MTQ4LDguOTQ1MiAwLjA2MDIsMTYuNDk3MjUgLTAuMTM1MDQsMzMuMDA3MjQgMC4xMDEyNyw0OS40OTY1IDAuNzA0MzEsMy45MzAxOCA1LjExNDM2LDQuOTY0MTcgOC41MDgwNyw0LjQ0Njc5IDEwLjY5MzgsLTAuMDU5NCAyMS40MDExOCwwLjEzNzkxIDMyLjA4NjQyLC0wLjEwNDQ4IDMuNTM0MTYsLTAuNjQ5MjggNC45MzMxMSwtNC41NTU1MSA0LjQzNDQ4LC03Ljc1MDQzIDAsLTkuNDEwNjUgMCwtMTguODIxMjkgMCwtMjguMjMxOTMgLTEuMzIxNjksLTEuNzQ2NjIgLTQuMTc0NTcsLTEuMDgxMDggLTYuMTg4MTUsLTEuNjkxNjggLTUuMjA0NjQsLTAuNzc3NjkgLTEwLjQwOTI3LC0xLjU1NTM4IC0xNS42MTM5MSwtMi4zMzMwNyAtMS42NDI4NCwtNy40ODU1NCAtMy4wMzAxMSwtMTUuMDI0NzQgLTQuNjk5OTYsLTIyLjUwNDUyIC0zLjMyNjk0LC0wLjUzMjEgLTYuODMxOTEsLTAuMTYwNDYgLTEwLjI0MjY5LC0wLjI3MjM3IC0wLjkzNDY4LC0xMGUtNiAtMS44NjkzOSwxZS01IC0yLjgwNDA1LC0xMGUtNiB6IG0gOS42OTA5MiwxMy40ODU1NSBjIDQuNDQyODYsNS4yNDU0MyA4Ljg4NTcxLDEwLjQ5MDg3IDEzLjMyODU3LDE1LjczNjMgLTIuNzgxNTMsLTIuNjUzNjEgLTYuNjM2MTYsLTQuMTQwMjkgLTkuMTQ0MzQsLTYuOTMwMyAtMC45MTM3OSwtMy4xMzU0NCAtMi43NTYzLC01Ljg4NDc2IC00LjE4NDIzLC04LjgwNiB6IgogICAgICAgICBpZD0icmVjdDMwMTkiCiAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4KCjxzdmcKeT0iMzIwIgogICAKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgdmVyc2lvbj0iMS4xIgogICB3aWR0aD0iNjQiCiAgIGhlaWdodD0iNjQiCiAgIGlkPSJzdmczODA5IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjUgcjEwMDQwIgogICBzb2RpcG9kaTpkb2NuYW1lPSJpY29uX2xlZnQuc3ZnIj4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjNjM2MzYzIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuNjc4NDMxMzciCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9Ijk1OCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDU5IgogICAgIGlkPSJuYW1lZHZpZXcyOTk4IgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIzLjY4NzUiCiAgICAgaW5rc2NhcGU6Y3g9IjQ0LjA3NjY3OSIKICAgICBpbmtzY2FwZTpjeT0iNzAuNTA2MjUiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8cGF0aAogICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgZD0iTSAyNi41NjI1IDEuNjU2MjUgQyAyNS4xMDgxNTcgMS43MjI5MjEyIDIzLjYyOTEzMyAyLjEzMDk1MiAyMi4zNDM3NSAyLjkwNjI1IEMgMjIuOTU4OTY2IDMuMjc5NDg2NCAyMy41NDQ0ODUgMy43NDUzMjA5IDI0LjA2MjUgNC4yODEyNSBMIDUyLjU5Mzc1IDMzLjc4MTI1IEwgNDguNDY4NzUgMzcuMjgxMjUgTCAyMS4yMTg3NSA2MS4wMzEyNSBDIDIwLjg1Nzk3MyA2MS4zNDAyMyAyMC40NTgxOTMgNjEuNjAzMjc3IDIwLjA2MjUgNjEuODQzNzUgQyAyMy4yMzI4ODMgNjMuNzg3NzQzIDI3LjQ5NjY1MyA2My41NDk4NzcgMzAuNDM3NSA2MS4wMzEyNSBMIDU3LjY4NzUgMzcuMjgxMjUgTCA2MS44MTI1IDMzLjc4MTI1IEwgMzMuMjgxMjUgNC4yODEyNSBDIDMxLjQ5MDQzIDIuNDI4NTAzMiAyOS4wMTc1NSAxLjU0MzcwNDYgMjYuNTYyNSAxLjY1NjI1IHogIgogICAgIGlkPSJwYXRoMzA2OCIgLz4KICA8ZwogICAgIGlkPSJnMzAyNCIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgxLjI5Mzc3OTcsMCwwLDEuMjkzNzc5NywtNy4zMzg5MTM3LC05LjUxNDg4NTcpIj4KICAgIDxwYXRoCiAgICAgICBpZD0icmVjdDI5ODUiCiAgICAgICBkPSJtIDE1LjM3NSw4LjYyNSBjIC0xLjQ3NTg5NCwwLjA2NzY1OSAtMi45NDE3MzMsMC42MTE2MTUzIC00LjEyNSwxLjYyNSAtMi43MDQ2MTE0LDIuMzE2MzA4IC0yLjg5ODI1MzcsNi4yMzUzOTggLTAuNDM3NSw4Ljc4MTI1IGwgMjIsMjIuNzUgOS44MTI1LC04LjMxMjUgLTIyLjA2MjUsLTIyLjgxMjUgQyAxOS4xNzgzMjYsOS4yMjQyMDggMTcuMjcyNTc4LDguNTM4MDEwNCAxNS4zNzUsOC42MjUgeiIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPHBhdGgKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjYyIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICBpZD0icmVjdDI5ODciCiAgICAgICBkPSJNIDMzLjc4MTI1LDI0LjU2MjUgOS41LDQ1LjM0Mzc1IGMgLTIuNzA0NjExNiwyLjMxNjMwOCAtMi44OTgyNTM3LDYuMjM1Mzk3IC0wLjQzNzUsOC43ODEyNSAyLjQ2MDc1MywyLjU0NTg1MiA2LjYwNzg4OSwyLjcyMjU1OCA5LjMxMjUsMC40MDYyNSBMIDQyLjQ3MTkyOCwzMy41MDE1ODkgQyA0Mi4zMTk5OTQsMzMuMzQyOCA0MS43Mzg3NDksMzMuOTUyMzc1IDQxLjU5Mzc1LDMzLjc4MTI1IHoiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIiAvPgogIDwvZz4KPC9zdmc+Cgo8c3ZnCnk9IjM4NCIKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIHZlcnNpb249IjEuMSIKICAgd2lkdGg9IjY0IgogICBoZWlnaHQ9IjY0IgogICBpZD0ic3ZnMzgwOSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC41IHIxMDA0MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iaWNvbl9jcm9zcy5zdmciPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiM2MzYzNjMiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC42Nzg0MzEzNyIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iOTU4IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwNTkiCiAgICAgaWQ9Im5hbWVkdmlldzI5OTgiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjUuMjE0OTEyNSIKICAgICBpbmtzY2FwZTpjeD0iMTUuNTM2NjY2IgogICAgIGlua3NjYXBlOmN5PSIyNi4wMzc3MzUiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjE5IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMzgwOSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzMzgxMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzODE0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlkPSJnMzAyNCIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgxLjI5Mzc3OTcsMCwwLDEuMjkzNzc5NywtNy4zMzg5MTM3LC05LjUxNDg4NTcpIj4KICAgIDxwYXRoCiAgICAgICBpZD0icmVjdDI5ODUiCiAgICAgICBkPSJtIDE1LjM3NSw4LjYyNSBjIC0xLjQ3NTg5NCwwLjA2NzY1OSAtMi45NDE3MzMsMC42MTE2MTUzIC00LjEyNSwxLjYyNSAtMi43MDQ2MTE0LDIuMzE2MzA4IC0yLjg5ODI1MzcsNi4yMzUzOTggLTAuNDM3NSw4Ljc4MTI1IGwgMjIsMjIuNzUgOS44MTI1LC04LjMxMjUgLTIyLjA2MjUsLTIyLjgxMjUgQyAxOS4xNzgzMjYsOS4yMjQyMDggMTcuMjcyNTc4LDguNTM4MDEwNCAxNS4zNzUsOC42MjUgeiIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPHBhdGgKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjYyIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICBpZD0icmVjdDI5ODciCiAgICAgICBkPSJNIDMzLjc4MTI1LDI0LjU2MjUgOS41LDQ1LjM0Mzc1IGMgLTIuNzA0NjExNiwyLjMxNjMwOCAtMi44OTgyNTM3LDYuMjM1Mzk3IC0wLjQzNzUsOC43ODEyNSAyLjQ2MDc1MywyLjU0NTg1MiA2LjYwNzg4OSwyLjcyMjU1OCA5LjMxMjUsMC40MDYyNSBMIDQyLjQ3MTkyOCwzMy41MDE1ODkgQyA0Mi4zMTk5OTQsMzMuMzQyOCA0MS43Mzg3NDksMzMuOTUyMzc1IDQxLjU5Mzc1LDMzLjc4MTI1IHoiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIiAvPgogIDwvZz4KPC9zdmc+Cgo8c3ZnCnk9IjQ0OCIKICAgCiAgIAogICAKICAgCiAgIAogICAKICAgCiAgIHZlcnNpb249IjEuMSIKICAgd2lkdGg9IjY0IgogICBoZWlnaHQ9IjY0IgogICBpZD0ic3ZnMzgwOSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC41IHIxMDA0MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iaWNvbl9wbGF5LnN2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iIzYzNjM2MyIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjY3ODQzMTM3IgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSI5NTgiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1OSIKICAgICBpZD0ibmFtZWR2aWV3Mjk5OCIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iMy42ODc1IgogICAgIGlua3NjYXBlOmN4PSI0NC4wNzY2NzkiCiAgICAgaW5rc2NhcGU6Y3k9IjcwLjUwNjI1IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIxOSIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9InN2ZzM4MDkiIC8+CiAgPGRlZnMKICAgICBpZD0iZGVmczM4MTEiIC8+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhMzgxNCI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGU+PC9kYzp0aXRsZT4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPHJlY3QKICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lIgogICAgIGlkPSJyZWN0MzEwNCIKICAgICB3aWR0aD0iNTkuMTE4NjQ1IgogICAgIGhlaWdodD0iNTguMzA1MDg0IgogICAgIHg9IjIuNDQwNjc3OSIKICAgICB5PSIyLjQ0MDY3NzYiCiAgICAgcng9IjcuNzY4NjQ4MSIKICAgICByeT0iNS41ODU5NjgiIC8+Cjwvc3ZnPgoKPC9zdmc+);background-repeat:no-repeat;display:inline-block;width:64px;height:64px;z-index:1;margin-top:-16px;transform:scale(0.6)}.icon_cross:hover,.icon_cycle:hover,.icon_hdd:hover,.icon_left:hover,.icon_pack:hover,.icon_play:hover,.icon_right:hover,.icon_stop:hover{transform:scale(0.75);transition-duration:400ms}.icon_cross{background-position:0 0px}.icon_cycle{background-position:0 -64px}.icon_hdd{background-position:0 -128px}.icon_left{background-position:0 -192px}.icon_pack{background-position:0 -256px}.icon_play{background-position:0 -320px}.icon_right{background-position:0 -384px}.icon_stop{background-position:0 -448px}
        </style>
        <script src="//cdn.jsdelivr.net/isotope/2.0.0/isotope.pkgd.min.js"></script>
        <script type="text/javascript">
" use strict "
var data={};var pass='';var page_size=25;var cur_image=0;var isotope=0;var popup_delay=3000;var _popups=[];var _cur_popup=0;var expertise_level=0;function display_popup(content,opts){var opts=opts||{};var flush=!!opts.flush;if(_cur_popup!=0&&!flush){_popups.push([content,opts])}else{var o=QS('#popup');o.innerHTML=content;o.classList.remove("slide-down");if(!!!opts.stay){_cur_popup=setTimeout(remove_popup,popup_delay);}}}
function remove_popup(){var o=QS('#popup');_cur_popup=0;if(_popups.length!=0){var content=_popups.pop();display_popup(content[0],content[1]);}else{o.classList.add('slide-down');}}
var DC=function(query,klass){var q=document.querySelector(query);if(q)
q.classList.remove(klass);};var DCA=function(query,klass){var q=document.querySelectorAll(query);for(var i=0;i<q.length;i++){q[i].classList.remove(klass);}};var AC=function(query,klass){var q=document.querySelectorAll(query);for(var i=0;i<q.length;i++){q[i].classList.add(klass);}};var QSA=function(query){return document.querySelectorAll(query);};var QS=function(query){return document.querySelector(query);};var CE=function(tag){return document.createElement(tag);}
var switch_page=function(nr){isotope.arrange({filter:'.p'+nr});DCA('button','current');QSA('button')[nr].classList.add('current');}
var _set_left_image=function(url){setTimeout(function(){QS('#prev_projected').src=url;},550);}
var _set_right_image=function(url){setTimeout(function(){QS('#next_projected').src=url;},500);}
var _set_image=function(){_image_setter=0;QS('#projected').src=pass+'/'+data[cur_image].f;var txt=data[cur_image].f.replace(/.*[/]/,'');txt+=' ('+(1+cur_image)+'/'+data.length+')';QS('#projected_name').textContent=txt;}
var slideshow_id=false;var _start_show=function(){var slideshow_delay=Math.floor(parseFloat(QS('#delay').value)*1000);slideshow_id=setTimeout(next_image,slideshow_delay);}
var _slideshow_pressed=0;function show(list){for(var i=0;i<list.length;i++){QS(list[i]).style.visibility="";}}
function hide(list){for(var i=0;i<list.length;i++){QS(list[i]).style.visibility="hidden";}}
var slideshow_button=function(){if(_slideshow_pressed){clearTimeout(_slideshow_pressed);_slideshow_pressed=0;}
var p=QS('#projected');if(slideshow_id){clearTimeout(slideshow_id);slideshow_id=false;show(['#projected_name','#next_button','#prev_button']);QS('#slide_button').classList.remove('icon_stop');QS('#slide_button').classList.add('icon_play');p.style.transform='translate(0, 0) scale(1.0)';setTimeout(_set_image,300);}else{hide(['#projected_name','#next_button','#prev_button']);QS('#slide_button').classList.remove('icon_play');QS('#slide_button').classList.add('icon_stop');slideshow_id=1;_slideshow_pressed=setTimeout(next_image,1300);p.style.transform='translate(0, 0) scale(1.1)';setTimeout(function(){p.style.transform='translate(0, -16px) scale(1.1)';},300);}}
var _image_setter=0;var view_image=function(obj,counter){if(expertise_level==0){display_popup('Click on the "play" icon to start slideshow, you can use ARROWS and ESCAPE here');expertise_level++;}
cur_image=counter;if(QS('#projector').classList.contains('slide-down')){QS('div#container').style.visibility='hidden';DC('#projector','slide-down');QS('#projected').src=pass+'/'+data[cur_image].t;}
if(!!_image_setter){clearTimeout(_image_setter)}
_image_setter=setTimeout(_set_image,250);}
var next_image=function(user_action){var user_action=user_action||false;if(user_action&&!!slideshow_id){if(cur_image+1<data.length)
cur_image++;slideshow_button();}else{if(cur_image+1<data.length){_set_left_image(pass+'/'+data[cur_image].f);QS('#next_button').classList.add('busy');setTimeout(function(){cur_image++;_set_image();if(cur_image+1<data.length){_set_right_image(pass+'/'+data[cur_image+1].f);}},10);}else{if(!!slideshow_id){_set_image();slideshow_button();}}}}
var prev_image=function(user_action){var user_action=user_action||false;if(user_action&&!!slideshow_id){if(cur_image>0)
cur_image--;slideshow_button();}else{if(cur_image>0){AC('#prev_button','busy');setTimeout(function(){_set_right_image(pass+'/'+data[cur_image].f);cur_image--;if(cur_image>0){_set_left_image(pass+'/'+data[cur_image-1].f);}
_set_image();},10);}}}
var close_projector=function(){AC('#projector','slide-down');QS('div#container').style.visibility='visible';AC('#projected','loading');if(slideshow_id)slideshow_button();}
function start_process(){var container=QS('#container');isotope=new Isotope(container,{itemSelector:'.item',isFitWidth:true,filter:'.p0'});QS('#dl_ref').style.visibility="hidden";QS('#dl_ref').setAttribute('href','./'+pass+'/package.zip');var xhr=new XMLHttpRequest();xhr.open('GET','./'+pass+'/images.js',true);xhr.overrideMimeType('text/javascript; charset=utf-8');xhr.onreadystatechange=function(e){if(this.readyState==4&&this.status==200){data=JSON.parse(this.responseText);if(!!data.version){data=uncompress_resources(data);}
var pages=QS('#pages #page_list');for(var i=0;i<data.length;i=i+page_size){var p=i/page_size;var btn=CE('button');btn.onclick=function(){var page=p;return function(){switch_page(page)};}();btn.innerHTML='&nbsp;'+(p+1)+'&nbsp;';pages.appendChild(btn);};var html=[];var d={};var counter=0;for(var i in data){d=data[i];if(!!!d.s){var size='';}else{if(d.s>1100000){var size="&nbsp;"+(Math.floor(d.s/1000)/1000.0)+" MB";}else{var size="&nbsp;"+Math.floor(d.s/1000)+" kB";}}
html.push('<div title="'+d.f+size+'" class="item p'+Math.floor(counter/page_size)+'" ><img class="tn" onclick="view_image(this, '+counter+')" src="'+pass+'/'+d.t+'" ></img></div>');counter++;};setTimeout(function(){var e=CE('div');e.innerHTML=html.join('');isotope.insert(e);if(data.length>page_size)
QS('button').classList.add('current');},100);for(n=1;n<5;n++){setTimeout(function(){isotope.arrange();},n*2*100);}
QS('#dl_ref').style.visibility="visible";}else if(this.readyState==4){display_popup("<h1>Error loading images</h1>Perhaps the code is incorrect.",{'flush':true});QS('#dl_ref').style.visibility="hidden";}};xhr.send(null);QS('#projected').onload=function(e){DC('button.busy','busy');DC('#projected','loading');if(!!slideshow_id){_start_show();}};document.onkeydown=function(e){switch(e.which){case 27:if(!!slideshow_id){slideshow_button();}else{close_projector();}
break;case 37:prev_image(true);break;case 38:prev_image(true);break;case 39:next_image(true);break;case 40:next_image(true);break;default:return;}
e.preventDefault();};if(expertise_level==0)
display_popup('Welcome ! Click on an image to launch the viewer !');}
function _start_bootstrap(code){remove_popup();pass=code||QS("#codepopup input").value;start_process();}
function change_code(){QS('#container').innerHTML='';QS('#page_list').innerHTML='';display_popup('<form action="#" onsubmit="_start_bootstrap(); return false;" id="codepopup" >Code: <input type="text" ></input></form>',{'stay':true});QS('#codepopup input').focus();}
function uncompress_resources(keys_values_array){var keys=keys_values_array.c;var list_of_values=keys_values_array.r;var ret=[];for(var i=0;i<list_of_values.length;i++){var values=list_of_values[i];var item={};for(var pid=0;pid<keys.length;pid++){item[keys[pid]]=values[pid];}
ret.push(item);}
return ret;};var default_configuration={}
document.addEventListener('DOMContentLoaded',function(){var options=document.location.href.match('.*#(.*)');if(!!options){options=options[1].split(/ *,/);var tmp=null;for(var i=0;i<options.length;i++){tmp=options[i].split(/=/);default_configuration[tmp[0]]=tmp[1]}}
if(!!!default_configuration.code){display_popup('<form action="#" onsubmit="_start_bootstrap(); return false;" id="codepopup" >Code: <input type="text" ></input></form>',{'stay':true});QS('#codepopup input').focus();}else{_start_bootstrap(default_configuration.code);}});

        </script>
    </head>
    <body>
        <div id="global_container">
            <span class="pull-right"><h1><a id="dl_ref" style="visibility:hidden;" title="Download all images" class="bg_caption" href=""><div class="icon_hdd" ></div></a>&nbsp;<a class="bg_caption" href="#" title="Change current code" onclick="change_code()"><div class="icon_cycle" ></div></a></h1></span>
            <div id="pages"><span class="bg_caption"><span id="page_list" /></div>
            <hr />
            <div id="container">
            </div>
            <div id="popup"  class="slide-down">
            </div>
            <div id="projector"  class="slide-down">
                <div class="pull-right bigfont icon_cross" title="Close image viewer" onclick="close_projector()"></div>
                <span class="pull-right"><form action="#" onclick="return false;"><input class="bigfont" title="Slideshow delay" type="text" id="delay" size="3" value="3.5"></input>&nbsp;<div id="slide_button" class="bigfont icon_play" title="Toggle slideshow mode" onclick="slideshow_button(); false;"></div></form></span>
                <h1 id="projected_name">IMG XXX</h1>
                <br />
                <div id="next_button" title="Show next image" onclick="next_image(true)" class="pull-right bigfont icon_right"></div>
                <div id="prev_button" title="Show previous image" onclick="prev_image(true)" class="bigfont icon_left"></div>
                <img title="Use Arrow keys to change current image" id="projected" class="loading" />
                <img class="cache" id="next_projected" />
                <img class="cache" id="prev_projected" />
            </div>
        </div>
    </body>
</html>
"""

if __name__ == "__main__":
    import argparse

    parser = argparse.ArgumentParser(description='Make HTML5 Photo gallery.')
    parser.add_argument('input', metavar='FOLDER', type=str, help='folder with original images')
    parser.add_argument('-o', '--output', metavar='FOLDER', type=str, help='destination folder')
    parser.add_argument('-f', '--overwrite', action='store_true', help='overwrite files', default=False)
    parser.add_argument('-c', '--copy', action='store_true', help='copy original images', default=False)
    parser.add_argument('-s', '--resize', metavar='SIZE', action='store', help='resize original images when copying (give a maximum width or height in pixels, i.e: "1280") -- Implies "-c"', default=False)
    parser.add_argument('-q', '--quality', metavar='QUALITY', action='store', type=int, help='Output image quality in range [0-100]', default=90)
    args = parser.parse_args()

    if args.resize and not args.copy:
        args.copy = True

    print("Listing...")
    images  = ImageList(args.input, overwrite=args.overwrite)
    if len(images) == 0:
        print('\nError: No image found.')
        raise SystemExit(1)
    out = Output(args.output or args.input)
    if not os.path.exists(out.path):
        os.makedirs(out.path)
    print("\nWriting web page")
    w = HTMLWriter(images, out)
    w.write()
    w = JSONWriter(images, out)
    w.write()
    package_files = []
    if args.copy:
        noop = args.input == args.output
        img_mgr = ImageHandler()
        print("\nCopying...")
        sz = int(args.resize)
        for i, fname in enumerate(images.filenames):
            print('\r' + progress_maker(i, len(images.filenames)), end='')
            out_fname = os.path.join(out.path, os.path.basename(fname))
            package_files.append( out_fname )
            if noop or ( os.path.exists(out_fname) and not args.overwrite):
                continue
            rot = img_mgr.get_rotation(fname)
            if args.resize:
                src_img = img_mgr.minify( fname , sz )
                img_mgr.current_img = src_img
            src_img = img_mgr.rotate( fname, rot )
            img_mgr.save( src_img, out_fname, quality=args.quality)


    print("\nMaking thumbnails...")
    images.make_thumbs(out) # TODO: re-use scaled+rotated images instead of originals

    zfname = os.path.join(out.path, 'package.zip')

    if not os.path.exists(zfname) or args.overwrite:
        print("\nZipping...")
        import zipfile
        z = zipfile.ZipFile( zfname, 'w')
        for i, fname in enumerate(package_files or images.filenames):
            print('\r' + progress_maker(i, len(images.filenames)), end='')
            z.write( fname, os.path.basename(fname) )
        z.close()

    print("\n%d files processed."%len(images))
    open(os.path.join(out.path, os.path.pardir, 'index.html'), 'w').write(INDEX)

